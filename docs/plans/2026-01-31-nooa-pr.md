# nooa pr Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Integrate with GitHub to create, update, and review pull requests directly from CLI.

**Architecture:** Use GitHub REST API via fetch. Store GitHub token in environment or `.nooa/secrets`.

**Tech Stack:** Bun, TypeScript, GitHub REST API.

---

### Task 1: GitHub API Client

**Files:**
- Create: `src/core/integrations/github.ts`
- Test: `src/core/integrations/github.test.ts`

**Step 1: Write the failing test**

```typescript
import { expect, test, describe } from "bun:test";
import { GitHubClient } from "./github";

describe("GitHubClient", () => {
    test("can instantiate with token", () => {
        const client = new GitHubClient("test-token");
        expect(client).toBeDefined();
    });
});
```

**Step 2: Run test to verify it fails**

**Step 3: Write minimal implementation**

```typescript
// src/core/integrations/github.ts
export class GitHubClient {
    constructor(private token: string) {}

    async createPR(owner: string, repo: string, head: string, base: string, title: string, body: string) {
        const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/pulls`, {
            method: "POST",
            headers: {
                Authorization: `Bearer ${this.token}`,
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ title, body, head, base })
        });
        return response.json();
    }

    async listPRs(owner: string, repo: string) {
        const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/pulls`, {
            headers: { Authorization: `Bearer ${this.token}` }
        });
        return response.json();
    }
}
```

**Step 4: Run test to verify it passes**

**Step 5: Commit**

```bash
git add src/core/integrations/github.ts
git commit -m "feat: add GitHub API client"
```

---

### Task 2: CLI Command `nooa pr`

**Files:**
- Create: `src/features/pr/cli.ts`

**Step 1: Write the failing test**

```typescript
test("pr --help shows usage", async () => {
    const { stdout } = await execa("bun", ["index.ts", "pr", "--help"], { reject: false });
    expect(stdout).toContain("Usage: nooa pr");
});
```

**Step 2: Run test to verify it fails**

**Step 3: Write minimal implementation**

```typescript
// src/features/pr/cli.ts
import type { Command, CommandContext } from "../../core/command";
import { parseArgs } from "node:util";
import { GitHubClient } from "../../core/integrations/github";

const prHelp = `
Usage: nooa pr <subcommand> [flags]

Manage GitHub Pull Requests.

Subcommands:
  create --title <t> --body <b>    Create a new PR.
  list                              List open PRs.
  review <number>                   Review a specific PR.

Flags:
  --json         Output as JSON.
  -h, --help     Show help.
`;

const prCommand: Command = {
    name: "pr",
    description: "Manage GitHub PRs",
    execute: async ({ rawArgs }: CommandContext) => {
        const { values, positionals } = parseArgs({
            args: rawArgs,
            options: {
                help: { type: "boolean", short: "h" },
                json: { type: "boolean" },
                title: { type: "string" },
                body: { type: "string" }
            },
            allowPositionals: true, strict: false
        });
        if (values.help) { console.log(prHelp); return; }

        const token = process.env.GITHUB_TOKEN;
        if (!token) { console.error("Error: GITHUB_TOKEN required"); process.exitCode = 2; return; }

        const sub = positionals[1];
        const client = new GitHubClient(token);

        if (sub === "create") {
            console.log("Creating PR...");
            // Implementation
        } else if (sub === "list") {
            console.log("Listing PRs...");
            // Implementation
        } else {
            console.log(prHelp);
        }
    }
};

export default prCommand;
```

**Step 4: Run test to verify it passes**

**Step 5: Commit**

```bash
git add src/features/pr/
git commit -m "feat: add nooa pr command"
```
