bun test v1.3.6 (d530ed99)

index.nooa.test.ts:
(pass) nooa root > nooa --help shows root usage and subcommands [130.26ms]
(pass) nooa root > nooa --version prints 0.0.1 [88.54ms]
(pass) nooa root > package.json exposes nooa bin [0.90ms]

tests/contract.test.ts:
(pass) NOOA Contract Tests > Init Contract > should create .nooa directory and core files [14.66ms]
(pass) NOOA Contract Tests > Init Contract > should fail if .nooa already exists without --force [0.65ms]
(pass) NOOA Contract Tests > Init Contract > should succeed if .nooa already exists with --force [2.07ms]
(pass) NOOA Contract Tests > Prompt Injection Contract > should follow precedence: constitution -> soul -> user -> memory [1.18ms]
(pass) NOOA Contract Tests > Prompt Injection Contract > should truncate content when budgets are exceeded [1.01ms]
(pass) NOOA Contract Tests > Memory Contract > should generate valid YAML entries [120.51ms]
(pass) NOOA Contract Tests > Memory Contract > should promote entries to durable memory [14.53ms]
(pass) NOOA Contract Tests > Reflection Contract > should only reflect on material events [0.95ms]
(pass) NOOA Contract Tests > Reflection Contract > should reflect on material events [23.72ms]
(pass) NOOA Contract Tests > Reflection Contract > should cap reflections at 3 per session [39.60ms]
(pass) NOOA Contract Tests > Locking Contract > should prevent concurrent writes to memory [76.46ms]

src/core/telemetry.test.ts:
(pass) TelemetryStore > tracks events in sqlite [2.57ms]
(pass) TelemetryStore > applies limit when provided [2.13ms]
(pass) TelemetryStore > filters by level and trace_id [1.99ms]
(pass) TelemetryStore > reopens database if closed [1.86ms]

src/core/registry.test.ts:
(pass) CommandRegistry > registers and retrieves a command
(pass) CommandRegistry > lists registered commands

src/core/io.test.ts:
(pass) IO Utilities > runWithStdin provides mock constant content [0.25ms]
(pass) IO Utilities > getStdinText returns empty string when TTY [0.04ms]
(pass) IO Utilities > getStdinText reads from non-TTY stream async iterator [0.35ms]
(pass) IO Utilities > getStdinText handles async iterator error [0.20ms]
(pass) IO Utilities > getStdinText handles stream events [1.27ms]
(pass) IO Utilities > getStdinText handles stream timeout [201.32ms]
(pass) IO Utilities > getStdinText handles stream error [1.24ms]

src/core/loader.test.ts:
no export
(pass) Command Loader > loads commands from directory [1.31ms]

src/core/logger.test.ts:
(pass) Logger > createTraceId returns string
(pass) Logger > createTraceId fallback
(pass) Logger > basic logging [0.15ms]
(pass) Logger > levels [0.29ms]
(pass) Logger > async context [0.07ms]
(pass) Logger > setContext / clearContext (async) [0.10ms]
(pass) Logger > sync context fallback [0.05ms]
(pass) Logger > createLogger factory
(pass) Logger > default writer uses stderr

src/core/event-bus.test.ts:
(pass) EventBus > publishes events to subscribers
(pass) EventBus > unsubscribes from events
(pass) EventBus > removes event entry when last handler is removed
(pass) EventBus > handles off with non-existent event
(pass) EventBus > handles emit with no subscribers
(pass) EventBus > creates EventBus instance

src/runtime/types.test.ts:
(pass) ToolResult > creates basic result with forLlm only
(pass) ToolResult > creates silent result
(pass) ToolResult > creates error result
(pass) ToolResult > creates async result
(pass) ToolResult > creates user-facing result

src/runtime/tool-registry.test.ts:
(pass) ToolRegistry > registers and retrieves a tool
(pass) ToolRegistry > executes a tool and returns ToolResult
(pass) ToolRegistry > returns error for unknown tool
(pass) ToolRegistry > lists all registered tools
(pass) ToolRegistry > generates tool definitions for LLM prompt
(pass) ToolRegistry with DangerousCommandGuard > blocks dangerous commands in exec-like tools [0.92ms]
(pass) ToolRegistry with DangerousCommandGuard > allows safe commands through guard
(pass) ToolRegistry with DangerousCommandGuard > blocks dangerous commands in non-command string args

tests/core/cohesion.test.ts:
(pass) Command Cohesion Contract > Command: prompt > prompt should support --help and return exit 0 [103.15ms]
(pass) Command Cohesion Contract > Command: prompt > prompt should NOT have logs in stdout when --json is used [191.79ms]
(pass) Command Cohesion Contract > Command: prompt > prompt should record telemetry success or failure [89.40ms]
(pass) Command Cohesion Contract > Command: review > review should support --help and return exit 0 [87.26ms]
(pass) Command Cohesion Contract > Command: review > review should NOT have logs in stdout when --json is used [197.71ms]
(pass) Command Cohesion Contract > Command: review > review should record telemetry success or failure [102.18ms]
(pass) Command Cohesion Contract > search should validate max-results and return exit 2 [89.99ms]

tests/integration/events.act.test.ts:

ðŸ Result: ok
{"level":"info","event":"act.success","timestamp":1771227719558,"metadata":{"turns":3}}
(pass) Integration: Act Events > should emit act.started and act.completed events [50.14ms]

tests/integration/events.worktree.test.ts:
Worktree created: /Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/.worktrees/test-integration-events-1771227719560
Branch: test-integration-events-1771227719560 (from main)
Install: skipped
Tests: skipped
{"level":"info","event":"worktree.success","timestamp":1771227719905}
(pass) Integration: Worktree Events > should emit worktree.acquired and worktree.released events [378.80ms]

tests/scripts/measure-prompt-stats.test.ts:
(pass) measurePromptStats > returns token stats for dynamic prompt [37.15ms]

tests/scripts/generate-docs.test.ts:
(pass) docs generator > generateFeatureDoc creates markdown [0.11ms]
(pass) docs generator > generateManifest creates manifest JSON [0.04ms]

src/core/worktree/Pool.test.ts:
(pass) WorktreePool > acquires and releases worktrees [92.33ms]
(pass) WorktreePool > resolves repo root when not provided [95.91ms]
(pass) WorktreePool > enforces max worktree limit and lists active handles [87.74ms]

src/core/mcp/ConfigStore.test.ts:
(pass) ConfigStore can save and load MCP config [0.54ms]
(pass) ConfigStore can update existing MCP config [0.18ms]
(pass) ConfigStore can list all servers [0.18ms]
(pass) ConfigStore can delete a server [0.14ms]
(pass) ConfigStore returns undefined for non-existent server [0.07ms]

src/core/mcp/types.test.ts:
(pass) McpServer type is defined [0.02ms]
(pass) McpTool type is defined [0.04ms]
(pass) McpResource type is defined [0.01ms]
(pass) McpPrompt type is defined [0.01ms]

src/core/mcp/ServerManager.test.ts:
(pass) ServerManager can start a server [23.51ms]
(pass) ServerManager tracks running servers [19.94ms]
(pass) ServerManager can stop a specific server [19.05ms]
(pass) ServerManager can get running client [19.91ms]
(pass) ServerManager stops all servers on stopAll [39.48ms]
(pass) ServerManager returns list of running servers [20.82ms]

src/core/mcp/alias.test.ts:
(pass) aliases persist metadata and respect deletion [2.48ms]

src/core/mcp/Registry.test.ts:
(pass) Registry.healthCheck returns healthy status [21.04ms]
(pass) Registry.healthCheck marks disabled servers as down [3.05ms]

src/core/mcp/Client.test.ts:
(pass) callTool retries until transient failures resolve [3.68ms]
(pass) callTool throws after max retries [3.44ms]
(pass) Client methods delegate to sendRequest [0.11ms]
(pass) Real Client flow with mock process [0.11ms]

src/core/mcp/ToolProvider.test.ts:
(pass) ToolProvider can get tools from enabled MCPs [20.50ms]
(pass) ToolProvider can execute a tool [19.75ms]
(pass) ToolProvider returns empty array for no enabled MCPs [0.25ms]

src/core/integrations/github.test.ts:
(pass) GitHubClient > requestJson handles success [0.15ms]
(pass) GitHubClient > requestJson handles API error with message [0.10ms]
(pass) GitHubClient > requestJson handles API error without valid json [0.07ms]
(pass) GitHubClient > createPR sends correct body
(pass) GitHubClient > getPRDiff returns text [0.14ms]
(pass) GitHubClient > getPRDiff throws on failure [0.01ms]
(pass) GitHubClient > mergePR uses correct method [0.10ms]
(pass) GitHubClient > closePR sends closed state [0.03ms]
(pass) GitHubClient > commentPR sends body [0.05ms]
(pass) GitHubClient > getPRStatus aggregates info, approvals and checks [0.24ms]
(pass) GitHubClient > getPRStatus handles missing labels or sha [0.04ms]

src/core/workflow/Engine.test.ts:
(pass) WorkflowEngine > fails when spec is missing [0.11ms]
(pass) WorkflowEngine > runs actions when gate passes

src/core/db/embeddings.test.ts:
(pass) Embeddings Schema > creates embeddings table [0.20ms]

src/core/db/index.test.ts:
(pass) Store > initializes tables [0.17ms]
(pass) Store > stores and searches embeddings [0.26ms]
(pass) Store > cosine similarity works
(pass) Store > handles zero vectors [0.50ms]
(pass) Store > handles dimension mismatch [0.19ms]
(pass) Store > updates embedding on conflict [0.15ms]
(pass) Store > clear removes all [0.29ms]

src/core/db/cron.test.ts:
(pass) Cron DB Schema > can create cron_jobs and cron_logs tables [0.27ms]

src/core/db/cron_store.test.ts:
(pass) CronStore > creates the cron_jobs table and persists jobs [0.26ms]
(pass) CronStore > getByName returns the job when exists [0.29ms]
(pass) CronStore > delete and toggle jobs behave consistently [0.40ms]
(pass) CronStore > recordExecution logs runs and listLogs returns entries [0.28ms]

src/core/skills/Discovery.test.ts:
(pass) Discovery > lists available skills in directory [1.32ms]

src/core/events/schema.test.ts:
(pass) Event schema > is a closed union

src/core/policy/PolicyEngine.test.ts:
(pass) PolicyEngine > identifies forbidden markers [0.59ms]
(pass) PolicyEngine > respects nooa-ignore comment [0.36ms]
(pass) PolicyEngine > respects .nooa-ignore file [0.34ms]
(pass) PolicyEngine > ignores non-source files and tests [0.13ms]
(pass) PolicyEngine > checkFiles aggregates results [0.51ms]
(pass) PolicyEngine > handles file read errors gracefully [0.24ms]

src/core/reflection/hook.test.ts:
(pass) Auto Reflection Hook > autoReflect adds observable memory entry [1.27ms]
(pass) Auto Reflection Hook > autoReflect skips excluded commands (e.g. reflection itself) [1.70ms]
(pass) Auto Reflection Hook > autoReflect skips help invocations [0.83ms]
(pass) Auto Reflection Hook > autoReflect skips version invocations [0.37ms]

src/features/commit/cli.test.ts:
(pass) nooa commit > shows help [95.33ms]
(pass) nooa commit > blocks TODO markers by default [202.77ms]
(pass) nooa commit > runs tests by default [248.38ms]

src/features/init/execute.test.ts:
(pass) executeInit > creates durable memory file in .nooa [2.97ms]

src/features/context/engine.test.ts:
(pass) ContextEngine > getEnvState returns os and cwd
(pass) ContextEngine > getGitState returns null outside a git repository [9.04ms]

src/features/context/execute.test.ts:
(pass) Context Builder > extracts context for a given file [0.37ms]
(pass) Context Builder > falls back to symbol lookup when file not found [0.39ms]
(pass) Context Builder > throws error when symbol lookup fails [0.02ms]
(pass) Context Builder > handles ripgrep error in symbol lookup [0.08ms]

src/features/context/cli.test.ts:
(pass) context CLI > outputs context for a file [241.60ms]
(pass) context CLI > includes MCP resources when requested [128.36ms]

src/features/identity/init.test.ts:
(pass) Identity Initialization > initIdentity creates necessary files [1.70ms]
(pass) Identity Initialization > initIdentity does not overwrite existing files by default [0.83ms]

src/features/embed/engine.test.ts:
(pass) embed engine > selects mock provider [0.08ms]
Embed result length: 8
Embed result provider: mock
(pass) embed engine > returns deterministic embedding from mock [0.25ms]

src/features/embed/cli.test.ts:
(pass) nooa embed cli direct > shows help via execute [0.49ms]
{"level":"info","event":"embed.success","timestamp":1771227721467,"metadata":{"input_type":"text","model":"nomic-embed-text","provider":"mock","include_embedding":false}}
(pass) nooa embed cli direct > embeds text success via execute [0.67ms]
{"level":"info","event":"embed.success","timestamp":1771227721468,"metadata":{"input_type":"file","model":"nomic-embed-text","provider":"mock","include_embedding":false}}
(pass) nooa embed cli direct > embeds file success via execute [0.48ms]
{"level":"error","event":"embed.failure","timestamp":1771227721468,"metadata":{"error":"Action (text/file) is required.","error_message":"Action (text/file) is required.","error_stack":"Error: Action (text/file) is required.\n    at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/core/command-builder.ts:359:10)\n    at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/embed/cli.test.ts:77:22)\n    at processTicksAndRejections (native:7:39)"}}
(pass) nooa embed cli direct > fails on missing action via execute [0.35ms]
{"level":"error","event":"embed.failure","timestamp":1771227721468,"metadata":{"action":"text","error":"Text is required.","error_message":"Text is required.","error_stack":"Error: Text is required.\n    at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/core/command-builder.ts:359:10)\n    at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/embed/cli.test.ts:91:22)\n    at processTicksAndRejections (native:7:39)"}}
(pass) nooa embed cli direct > fails on missing text via execute [0.18ms]
{"level":"error","event":"embed.failure","timestamp":1771227721469,"metadata":{"action":"file","error":"File path is required.","error_message":"File path is required.","error_stack":"Error: File path is required.\n    at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/core/command-builder.ts:359:10)\n    at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/embed/cli.test.ts:103:22)\n    at processTicksAndRejections (native:7:39)"}}
(pass) nooa embed cli direct > fails on missing file path via execute [0.21ms]
{"level":"error","event":"embed.failure","timestamp":1771227721469,"metadata":{"action":"unknown","error":"Unknown embed action.","error_message":"Unknown embed action.","error_stack":"Error: Unknown embed action.\n    at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/core/command-builder.ts:359:10)\n    at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/embed/cli.test.ts:115:22)\n    at processTicksAndRejections (native:7:39)"}}
(pass) nooa embed cli direct > fails on unknown action via execute [0.21ms]
{"level":"info","event":"embed.success","timestamp":1771227721469,"metadata":{"input_type":"text","model":"nomic-embed-text","provider":"mock","include_embedding":true}}
(pass) nooa embed cli direct > respects --include-embedding flag via execute [0.24ms]
âœ… Results written to /var/folders/_l/y_vlrgtn01n1dr23byr98ctr0000gn/T/nooa-embed-cli-direct-den2b/out.json
{"level":"info","event":"embed.success","timestamp":1771227721469,"metadata":{"input_type":"text","model":"nomic-embed-text","provider":"mock","include_embedding":false}}
(pass) nooa embed cli direct > respects --out flag via execute [0.49ms]
{"level":"error","event":"embed.failure","timestamp":1771227721470,"metadata":{"action":"file","error":"Failed to read file.","error_message":"Failed to read file.","error_stack":"Error: Failed to read file.\n    at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/core/command-builder.ts:359:10)\n    at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/embed/cli.test.ts:154:22)\n    at processTicksAndRejections (native:7:39)"}}
(pass) nooa embed cli direct > handles general errors gracefully in execute [0.34ms]

src/features/pwd/cli.test.ts:
(pass) pwd feature > run returns current working directory
(pass) pwd feature > pwdMeta exposes name and version [0.27ms]
(pass) pwd feature > pwdAgentDoc embeds instruction and version

src/features/chat/execute.test.ts:
(pass) executeMessage > returns message object with timestamp [0.76ms]
(pass) executeMessage > handles different roles [1.26ms]
(pass) executeMessage > formatOutput formats as JSON [0.03ms]
(pass) executeMessage > formatOutput formats as text [0.02ms]

src/features/chat/cli.test.ts:
(pass) Chat CLI > run returns error if text is missing
(pass) Chat CLI > run returns error if role is invalid
(pass) Chat CLI > run executes message and formats output
(pass) Chat CLI > run handles json flag
(pass) Chat CLI > run handles runtime error

src/features/ask/cli.test.ts:
(pass) ask CLI > uses default search limit when limit not provided [0.10ms]

src/features/tui/cli.test.ts:
(pass) tui cli > renders TailApp when tail flag is set [3.94ms]
(pass) tui cli > renders DashboardView when tail flag is false [0.16ms]

src/features/ignore/cli.integration.test.ts:
(pass) nooa ignore > shows help with check and test [95.35ms]
(pass) nooa ignore > prints ignored result when path matches [104.25ms]
(pass) nooa ignore > prints not ignored result when path does not match [100.81ms]
(pass) nooa ignore > tests a new pattern against provided paths [101.20ms]
(pass) nooa ignore > fails when test pattern matches nothing [101.79ms]

src/features/ignore/execute.test.ts:
(pass) Ignore Execute > loadIgnore returns empty array if file does not exist
(pass) Ignore Execute > loadIgnore reads and parses patterns
(pass) Ignore Execute > saveIgnore writes patterns with header
(pass) Ignore Execute > addPattern adds new pattern [0.48ms]
(pass) Ignore Execute > addPattern ignores duplicate pattern [0.05ms]
(pass) Ignore Execute > removePattern removes existing pattern [0.26ms]
(pass) Ignore Execute > removePattern ignores missing pattern
(pass) Ignore Execute > checkPathIgnored returns false if no ignore file
(pass) Ignore Execute > checkPathIgnored matches pattern [0.64ms]
(pass) Ignore Execute > checkPathIgnored returns false for non-match
(pass) Ignore Execute > checkPathIgnored handles dot path [0.79ms]
(pass) Ignore Execute > matchesPattern checks single pattern [0.15ms]

src/features/ignore/cli.test.ts:
(pass) Ignore CLI > run() handler > calls addPattern [0.43ms]
(pass) Ignore CLI > run() handler > calls removePattern [0.02ms]
(pass) Ignore CLI > run() handler > calls loadIgnore for list [0.01ms]
(pass) Ignore CLI > run() handler > calls checkPathIgnored
(pass) Ignore CLI > run() handler > calls matchesPattern for test [0.09ms]
(pass) Ignore CLI > run() handler > returns error for missing action [0.02ms]
(pass) Ignore CLI > run() handler > returns error for missing pattern in add [0.02ms]
(pass) Ignore CLI > run() handler > returns error for missing pattern in remove
(pass) Ignore CLI > run() handler > returns error for missing path in check
(pass) Ignore CLI > run() handler > returns error for unknown command [0.05ms]
(pass) Ignore CLI > run() handler > returns runtime_error on throw [0.06ms]
{"level":"info","event":"ignore.success","timestamp":1771227721995,"metadata":{"action":"add","pattern":"foo"}}
(pass) Ignore CLI > Command Execution (Output) > prints added pattern output (changed) [0.75ms]
{"level":"info","event":"ignore.success","timestamp":1771227721996,"metadata":{"action":"add","pattern":"foo"}}
(pass) Ignore CLI > Command Execution (Output) > prints added pattern output (not changed) [0.46ms]
{"level":"info","event":"ignore.success","timestamp":1771227721996,"metadata":{"action":"remove","pattern":"foo"}}
(pass) Ignore CLI > Command Execution (Output) > prints removed output [0.43ms]
{"level":"info","event":"ignore.success","timestamp":1771227721996,"metadata":{"action":"list"}}
(pass) Ignore CLI > Command Execution (Output) > lists patterns [0.36ms]
{"level":"info","event":"ignore.success","timestamp":1771227721997,"metadata":{"action":"list"}}
(pass) Ignore CLI > Command Execution (Output) > prints empty list message [0.37ms]
{"level":"info","event":"ignore.success","timestamp":1771227721997,"metadata":{"action":"check","pattern":"app.log"}}
(pass) Ignore CLI > Command Execution (Output) > check prints ignored match [0.43ms]
{"level":"info","event":"ignore.success","timestamp":1771227721998,"metadata":{"action":"check","pattern":"app.log"}}
(pass) Ignore CLI > Command Execution (Output) > check prints not ignored [0.58ms]
{"level":"info","event":"ignore.success","timestamp":1771227721998,"metadata":{"action":"test","pattern":"*.log"}}
(pass) Ignore CLI > Command Execution (Output) > test prints results [0.44ms]
{"level":"info","event":"ignore.success","timestamp":1771227721999,"metadata":{"action":"test","pattern":"*.log"}}
(pass) Ignore CLI > Command Execution (Output) > test prints no matches [0.50ms]
{"level":"error","event":"ignore.failure","timestamp":1771227721999,"metadata":{"action":"list","error":"Boom","error_message":"Boom","error_stack":"Error: Boom\n    at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/core/command-builder.ts:359:10)\n    at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/ignore/cli.test.ts:266:24)\n    at processTicksAndRejections (native:7:39)"}}
(pass) Ignore CLI > Command Execution (Output) > handles errors [0.76ms]
{"level":"error","event":"ignore.failure","timestamp":1771227722000,"metadata":{"error":"Subcommand required.","error_message":"Subcommand required.","error_stack":"Error: Subcommand required.\n    at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/core/command-builder.ts:359:10)\n    at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/ignore/cli.test.ts:278:24)\n    at processTicksAndRejections (native:7:39)"}}
(pass) Ignore CLI > Command Execution (Output) > handles missing command error in onFailure [0.65ms]
(pass) Ignore CLI > Command Execution (Output) > test missing pattern [0.09ms]
{"level":"info","event":"ignore.success","timestamp":1771227722001,"metadata":{"action":"list"}}
(pass) Ignore CLI > Command Execution (Output) > json output in onSuccess [0.76ms]
{"level":"error","event":"ignore.failure","timestamp":1771227722002,"metadata":{"action":"add","error":"Pattern required.","error_message":"Pattern required.","error_stack":"Error: Pattern required.\n    at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/core/command-builder.ts:359:10)\n    at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/ignore/cli.test.ts:313:24)\n    at processTicksAndRejections (native:7:39)"}}
(pass) Ignore CLI > Command Execution (Output) > handles missing pattern error in onFailure [0.70ms]
(pass) Ignore CLI > Command Execution (Output) > handles unknown mode in switch [0.03ms]
{"level":"info","event":"ignore.success","timestamp":1771227722002,"metadata":{"action":"remove","pattern":"foo"}}
(pass) Ignore CLI > remove pattern not found output [0.48ms]

src/features/ci/execute.test.ts:
(pass) executeCi > should return structured result with ok and traceId [257.52ms]

src/features/ci/cli.test.ts:
(pass) ci CLI > should show help [93.81ms]
(pass) ci CLI > should output JSON with correct schema [92.18ms]

src/features/doctor/execute.test.ts:
(pass) executeDoctorCheck > should check all required tools and return result [0.86ms]

src/features/doctor/cli.test.ts:
(pass) doctor CLI > should show help [89.28ms]
(pass) doctor CLI > should output JSON with correct schema [140.46ms]

src/features/read/cmd.test.ts:
(pass) Read Command Definition > exports valid command [0.09ms]
hello-read{"level":"info","event":"read.success","timestamp":1771227722682,"metadata":{"path":"telemetry-read.txt","bytes":10}}
(pass) Read Command Definition > records telemetry on successful read [2.06ms]

src/features/read/execute.test.ts:
(pass) read command > help: displays help [0.41ms]
{"level":"error","event":"read.failure","timestamp":1771227722685,"metadata":{"path":"","error":"Path is required.","error_message":"Path is required.","error_stack":"Error: Path is required.\n    at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/core/command-builder.ts:359:10)\n    at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/read/execute.test.ts:49:21)\n    at processTicksAndRejections (native:7:39)"}}
(pass) read command > failure: missing path and TTY [0.90ms]
{"level":"info","event":"read.success","timestamp":1771227722686,"metadata":{"path":"/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/read/tmp-test-read/stdin_path.txt","bytes":13}}
(pass) read command > success: read path from stdin [0.92ms]
{"level":"info","event":"read.success","timestamp":1771227722687,"metadata":{"path":"/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/read/tmp-test-read/test.json","bytes":12}}
(pass) read command > success: json output [0.87ms]
{"level":"error","event":"read.failure","timestamp":1771227722687,"metadata":{"path":"nonexistent.txt","error":"Failed to read file.","error_message":"Failed to read file.","error_stack":"Error: Failed to read file.\n    at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/core/command-builder.ts:359:10)\n    at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/read/execute.test.ts:119:21)\n    at processTicksAndRejections (native:7:39)"}}
(pass) read command > error handling: file not found [0.62ms]
{"level":"error","event":"read.failure","timestamp":1771227722688,"metadata":{"path":"/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/read/tmp-test-read","error":"Failed to read file.","error_message":"Failed to read file.","error_stack":"Error: Failed to read file.\n    at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/core/command-builder.ts:359:10)\n    at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/read/execute.test.ts:138:21)\n    at processTicksAndRejections (native:7:39)"}}
(pass) read command > error handling: other error [0.52ms]

src/features/read/cli.test.ts:
(pass) read feature > run accepts json flag for CLI parity [0.37ms]
(pass) read feature > readMeta exposes name and version [0.15ms]
(pass) read feature > readAgentDoc embeds instruction and version [0.16ms]
(pass) read feature > run respects basePath restriction [0.39ms]

src/features/worktree/events.test.ts:
Worktree created: /private/var/folders/_l/y_vlrgtn01n1dr23byr98ctr0000gn/T/nooa-worktree-events-TwWf9U/.worktrees/feat/event
Branch: feat/event (from main)
Install: skipped
Tests: skipped
{"level":"info","event":"worktree.success","timestamp":1771227722810}
Worktree removed: /private/var/folders/_l/y_vlrgtn01n1dr23byr98ctr0000gn/T/nooa-worktree-events-TwWf9U/.worktrees/feat/event
{"level":"info","event":"worktree.success","timestamp":1771227722833}
(pass) worktree events > emits acquired and released events [146.51ms]

src/features/worktree/execute.test.ts:
(pass) worktree output > writes summary to stderr and keeps stdout empty [249.82ms]

src/features/worktree/cli.test.ts:
(pass) nooa worktree > shows help [99.91ms]
(pass) nooa worktree > creates a worktree under .worktrees/<branch> [243.25ms]
(pass) nooa worktree > respects --no-install and --no-test [264.64ms]
(pass) nooa worktree > installs deps and runs tests by default [283.74ms]
(pass) nooa worktree > lists worktrees with list subcommand [491.64ms]
(pass) nooa worktree > reports worktree info from info subcommand [339.04ms]
(pass) nooa worktree > removes worktree using remove subcommand [351.28ms]
(pass) nooa worktree > prunes worktrees via prune subcommand [165.71ms]
(pass) nooa worktree > locks and unlocks worktrees [469.24ms]

src/features/code/cli-patch.test.ts:
(pass) nooa code write --patch > --help includes patch flags [94.25ms]
(pass) nooa code write --patch > applies patch from stdin [94.24ms]

src/features/code/write.test.ts:
(pass) writeCodeFile > writes content when file does not exist [0.48ms]
(pass) writeCodeFile > fails when file exists without overwrite [0.25ms]
(pass) writeCodeFile > overwrites when overwrite is true [0.26ms]
(pass) writeCodeFile > dry-run does not write file [0.08ms]

src/features/code/refactor.test.ts:
(pass) Code Refactor Feature > executeRefactor reads, prompts AI, and writes back [0.73ms]

src/features/code/cmd.test.ts:
(pass) Code Command Definition > exports valid command [0.19ms]
(pass) Code Command Definition > exposes meta and agent doc [0.02ms]

src/features/code/format.test.ts:
(pass) Code Format Feature > executeFormat runs biome wrapper [0.11ms]

src/features/code/cli-write.test.ts:
(pass) nooa code write > nooa code write --help shows usage [99.57ms]
(pass) nooa code write > writes from --from file [99.99ms]
(pass) nooa code write > fails if file exists without --overwrite [97.69ms]
(pass) nooa code write > supports --overwrite [97.23ms]
(pass) nooa code write > writes from stdin [101.04ms]
(pass) nooa code write > dry-run reports without writing [96.47ms]

src/features/code/patch.test.ts:
(pass) applyPatch > applies unified diff [0.10ms]

src/features/code/diff.test.ts:
(pass) Code Diff Feature > executeDiff returns diff output [0.06ms]
(pass) Code Diff Feature > executeDiff passes arguments to git diff [0.11ms]

src/features/code/cli-delete.test.ts:
(pass) nooa code delete/remove > nooa code --help shows delete and remove subcommands [95.51ms]
(pass) nooa code delete/remove > deletes file with delete subcommand [96.99ms]
(pass) nooa code delete/remove > deletes file with remove alias [99.09ms]
(pass) nooa code delete/remove > delete with --dry-run keeps file and returns JSON [98.13ms]

src/features/code/execute.test.ts:
{"level":"error","event":"code.failure","timestamp":1771227726978,"metadata":{"action":"write","error":"Destination path is required.","error_message":"Destination path is required.","error_stack":"Error: Destination path is required.\n    at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/core/command-builder.ts:359:10)\n    at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/code/execute.test.ts:42:21)\n    at processTicksAndRejections (native:7:39)"}}
(pass) code command execute > write: failure - missing path [1.28ms]
{"level":"info","event":"code.success","timestamp":1771227726979,"metadata":{"action":"write","mode":"write","path":"/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/code/tmp-test-code/test.txt"}}
(pass) code command execute > write: success - basic write [1.13ms]
{"level":"error","event":"code.failure","timestamp":1771227727182,"metadata":{"action":"write","path":"/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/code/tmp-test-code/test.txt","error":"Missing input. Use --from or stdin.","error_message":"Missing input. Use --from or stdin.","error_stack":"Error: Missing input. Use --from or stdin.\n    at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/core/command-builder.ts:359:10)\n    at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/code/execute.test.ts:86:21)\n    at processTicksAndRejections (native:7:39)"}}
(pass) code command execute > write: failure - missing input [202.68ms]
{"level":"info","event":"code.success","timestamp":1771227727183,"metadata":{"action":"write","mode":"write","path":"/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/code/tmp-test-code/dry.txt"}}
(pass) code command execute > write: dry-run [1.11ms]
{"level":"info","event":"code.success","timestamp":1771227727183,"metadata":{"action":"write","mode":"write","path":"/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/code/tmp-test-code/test.json"}}
(pass) code command execute > write: json output [0.89ms]
{"level":"info","event":"code.success","timestamp":1771227727184,"metadata":{"action":"write","mode":"patch","path":"/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/code/tmp-test-code/to_patch.txt"}}
(pass) code command execute > patch: basic success [0.96ms]
{"level":"info","event":"code.success","timestamp":1771227727185,"metadata":{"action":"patch","mode":"patch","path":"/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/code/tmp-test-code/to_patch_sub.txt"}}
(pass) code command execute > patch subcommand: implies patch mode [0.92ms]
(pass) code command execute > help: displays help and returns [0.22ms]
{"level":"error","event":"code.failure","timestamp":1771227727186,"metadata":{"action":"write","path":"any.txt","error":"--patch is mutually exclusive with --from.","error_message":"--patch is mutually exclusive with --from.","error_stack":"Error: --patch is mutually exclusive with --from.\n    at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/core/command-builder.ts:359:10)\n    at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/code/execute.test.ts:224:21)\n    at processTicksAndRejections (native:7:39)"}}
(pass) code command execute > error handling: patch exclusive with from [0.56ms]
{"level":"error","event":"code.failure","timestamp":1771227727388,"metadata":{"action":"write","path":"target.txt","error":"Missing patch input. Use --patch-from or stdin.","error_message":"Missing patch input. Use --patch-from or stdin.","error_stack":"Error: Missing patch input. Use --patch-from or stdin.\n    at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/core/command-builder.ts:359:10)\n    at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/code/execute.test.ts:244:21)\n    at processTicksAndRejections (native:7:39)"}}
(pass) code command execute > patch: missing input error [201.77ms]
{"level":"info","event":"code.success","timestamp":1771227727389,"metadata":{"action":"write","mode":"patch","path":"/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/code/tmp-test-code/to_patch_json.txt"}}
(pass) code command execute > patch: json output [1.22ms]
{"level":"info","event":"code.success","timestamp":1771227727390,"metadata":{"action":"write","mode":"write","path":"/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/code/tmp-test-code/stdin_out.txt"}}
(pass) code command execute > write: from stdin [1.06ms]
{"level":"error","event":"code.failure","timestamp":1771227727391,"metadata":{"action":"write","path":"/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/code/tmp-test-code","error":"File already exists: /Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/code/tmp-test-code","error_message":"File already exists: /Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/code/tmp-test-code","error_stack":"Error: File already exists: /Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/code/tmp-test-code\n    at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/core/command-builder.ts:359:10)\n    at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/code/execute.test.ts:331:21)\n    at processTicksAndRejections (native:7:39)"}}
(pass) code command execute > error handling: unexpected error [0.95ms]
{"level":"info","event":"code.success","timestamp":1771227727392,"metadata":{"action":"unknown","mode":"help"}}
(pass) code command execute > unknown action: displays help [0.55ms]
{"level":"info","event":"code.success","timestamp":1771227727393,"metadata":{"action":"delete","mode":"delete","path":"/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/code/tmp-test-code/delete-me.txt"}}
(pass) code command execute > delete: removes target file [0.99ms]
{"level":"info","event":"code.success","timestamp":1771227727393,"metadata":{"action":"remove","mode":"delete","path":"/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/code/tmp-test-code/remove-alias.txt"}}
(pass) code command execute > remove alias: removes target file [0.70ms]
{"level":"info","event":"code.success","timestamp":1771227727394,"metadata":{"action":"delete","mode":"delete","path":"/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/code/tmp-test-code/delete-json.txt"}}
(pass) code command execute > delete: json output includes delete mode [0.78ms]

src/features/act/events.test.ts:
Error: Goal is required.
{"level":"error","event":"act.failure","timestamp":1771227727396,"metadata":{"error":"Goal is required.","error_message":"Goal is required.","error_stack":"Error: Goal is required.\n    at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/core/command-builder.ts:359:10)\n    at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/act/events.test.ts:21:20)\n    at processTicksAndRejections (native:7:39)"}}
(pass) act events > emits failed when goal is missing [0.59ms]

src/features/act/workflow.test.ts:
(pass) act workflow integration > fails when workflow spec gate is missing and emits workflow events [0.41ms]

src/features/agent/cli.test.ts:
(pass) Agent CLI > exports a command with name 'agent'
(pass) Agent CLI > has help text mentioning agentic loop

src/features/mcp/configure.test.ts:
(pass) configure merges env from --env-file [3.73ms]
(pass) configure picks up .mcp.env when present [2.18ms]
(pass) configure honors global -> root -> explicit env files [3.08ms]

src/features/mcp/init.test.ts:
(pass) nooa mcp init installs recommended MCPs [4.00ms]
(pass) nooa mcp init respects --skip-github [1.84ms]
(pass) nooa mcp init --github-token configures GitHub env [1.91ms]
(pass) interactive wizard prompts for GitHub token [1.82ms]
(pass) nooa mcp init shows help [0.05ms]
ðŸš€ MCP onboarding complete!
 - filesystem: installed
 - github: installed
Run `nooa mcp list --installed` to see them.
(pass) nooa mcp init skips existing if not forced [1.81ms]
(pass) interactive 'no' skips installation [0.97ms]
ðŸš€ MCP onboarding complete!
 - filesystem: installed
 - github: installed
Run `nooa mcp list --installed` to see them.
(pass) force reinstall removes existing [2.95ms]
(pass) init honors env var NOOA_NON_INTERACTIVE [1.59ms]
(pass) prompt handles defaults for empty inputs [2.10ms]
(pass) nooa mcp init emits JSON [0.37ms]
Error initializing MCPs: 215 | 
216 | test("init handles errors gracefully", async () => {
217 | 	await withDb(async () => {
218 | 		setInitInteractive(true);
219 | 		setInitPromptFactory(() => {
220 | 			throw new Error("Prompt Error");
               ^
error: Prompt Error
      at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/mcp/init.test.ts:220:10)
      at initCommand (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/mcp/init.ts:111:13)
      at initCommand (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/mcp/init.ts:75:35)
      at captureLog (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/mcp/init.test.ts:38:26)
      at captureLog (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/mcp/init.test.ts:33:27)
      at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/mcp/init.test.ts:223:30)
      at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/mcp/init.test.ts:217:15)
      at withDb (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/mcp/init.test.ts:19:9)
      at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/mcp/init.test.ts:217:8)

(pass) init handles errors gracefully [2.38ms]

src/features/mcp/install.test.ts:
âœ… Installed MCP "server-filesystem"
ðŸ”§ Command: bun 
ðŸ“¦ Package: @modelcontextprotocol/server-filesystem
(pass) nooa mcp install registers an MCP [1.74ms]
âœ… Installed MCP "server-filesystem"
ðŸ”§ Command: bun 
ðŸ“¦ Package: @modelcontextprotocol/server-filesystem
{
  "id": "7746832e-7034-4261-8925-36cde22d4ba9",
  "name": "server-filesystem",
  "package": "@modelcontextprotocol/server-filesystem",
  "command": "bun",
  "args": [],
  "env": {},
  "enabled": true,
  "installedAt": 1771227727453,
  "updatedAt": 1771227727453
}
(pass) nooa mcp info prints saved MCP metadata [1.68ms]
âœ… Installed MCP "server-filesystem"
ðŸ”§ Command: bun 
ðŸ“¦ Package: @modelcontextprotocol/server-filesystem
âœ… Updated MCP "server-filesystem"
(pass) nooa mcp configure updates settings [1.96ms]

src/features/mcp/subcommands.test.ts:
Usage: nooa mcp list [options]

Options:
  --installed    List all installed MCPs
  --enabled      List only enabled MCPs (default)
  --json         Output as JSON
  -h, --help     Show this help message
(pass) list command shows help [0.59ms]
Usage: nooa mcp install <package> [options]

Arguments:
  package        NPM package name, git URL, or local path

Options:
  --name <name>     Override the MCP name (defaults to derived name)
  --command <cmd>   Binary to execute (default: bun)
  --args <arg>      Arguments to pass to the binary (repeatable)
  --env <KEY=VAL>   Environment variables for the MCP (repeatable)
  --force           Overwrite an existing MCP with the same name
  -h, --help        Show this help message

Examples:
  nooa mcp install @modelcontextprotocol/server-filesystem
  nooa mcp install ./local-mcp --name local --command node --args ./server.cjs
  nooa mcp install github:user/mcp --env GITHUB_TOKEN=xxx

(pass) install command shows help [0.06ms]
Error: Package name required
Run "nooa mcp install --help" for usage
(pass) install command requires package name [0.03ms]
Usage: nooa mcp enable <name>

Arguments:
  name          Name of the MCP server to enable

Options:
  -h, --help     Show this help message
(pass) enable command shows help [0.02ms]
Error: MCP name required
(pass) enable command requires MCP name [0.10ms]
Usage: nooa mcp disable <name>

Arguments:
  name          Name of the MCP server to disable

Options:
  -h, --help     Show this help message
(pass) disable command shows help
Error: MCP name required
(pass) disable command requires MCP name

src/features/mcp/uninstall.test.ts:
{
  "name": "mock",
  "removed": true
}
(pass) nooa mcp uninstall removes an entry [2.98ms]

src/features/mcp/alias.test.ts:
(pass) alias create/list/delete flow [3.13ms]
(pass) list shows json output when --json [1.60ms]

src/features/mcp/test.test.ts:
(pass) nooa mcp test checks server health [24.02ms]

src/features/mcp/marketplace.test.ts:
filesystem (yes)
  File-based MCP
  id: fs
github (no)
  GitHub MCP
  id: gh
db (no)
  Database MCP
  id: db
(pass) marketing command prints results [0.72ms]
filesystem (yes)
  File-based MCP
  id: fs
db (no)
  Database MCP
  id: db
(pass) marketplace supports verified-only filter
(pass) marketplace emits JSON output

src/features/mcp/enable-disable.test.ts:
âœ… Enabled MCP: mock
(pass) nooa mcp enable toggles a disabled MCP [2.17ms]
âœ… Disabled MCP: mock
(pass) nooa mcp disable turns off an enabled MCP [1.85ms]

src/features/mcp/call.test.ts:
(pass) nooa mcp call executes an MCP tool [23.72ms]
(pass) nooa mcp call accepts retry/backoff flags [22.66ms]

src/features/mcp/resource.test.ts:
(pass) nooa mcp resource reads a resource URI [22.44ms]

src/features/mcp/cli.test.ts:
(pass) MCP CLI Dispatcher > shows help with no args [0.42ms]
(pass) MCP CLI Dispatcher > shows help with --help [0.17ms]
{"level":"error","event":"mcp.failure","timestamp":1771227727624,"metadata":{"command":"unknown","error":"Unknown subcommand: unknown","error_message":"Unknown subcommand: unknown","error_stack":"Error: Unknown subcommand: unknown\n    at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/core/command-builder.ts:359:10)\n    at async mcpCommand (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/mcp/cli.ts:214:22)\n    at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/mcp/cli.test.ts:51:22)\n    at processTicksAndRejections (native:7:39)"}}
(pass) MCP CLI Dispatcher > handles unknown subcommand [0.99ms]
{"level":"info","event":"mcp.success","timestamp":1771227727625,"metadata":{"command":"test_cmd","exit_code":42}}
(pass) MCP CLI Dispatcher > dispatches subcommands [0.51ms]

src/features/mcp/list.test.ts:
(pass) nooa mcp list --installed includes every MCP [2.85ms]
(pass) nooa mcp list --enabled shows enabled MCPs only [2.18ms]

src/features/mcp/health.test.ts:
(pass) nooa mcp health prints error when name missing [0.71ms]
(pass) nooa mcp health returns healthy status text [22.00ms]
(pass) nooa mcp health --json returns structured status [22.38ms]

src/features/search/engine.test.ts:
(pass) Search Engine > native search finds exact matches [1.27ms]
(pass) Search Engine > native search respects include patterns [0.92ms]
(pass) Search Engine > native search respects exclude patterns [0.78ms]
(pass) Search Engine > native search supports regex [0.83ms]
(pass) Search Engine > native search supports context [0.93ms]
(pass) Search Engine > native search supports count mode [0.93ms]
(pass) Search Engine > native search handles large files (skip) [0.63ms]
(pass) Search Engine > native search ignores binary files [1.59ms]
(pass) Search Engine > rg search parses JSON output [1.53ms]
(pass) Search Engine > rg search handles context [0.81ms]

src/features/search/cli.test.ts:
(pass) nooa search > shows help [91.19ms]
(pass) nooa search > outputs JSON format [90.08ms]
(pass) nooa search > outputs plain format [93.80ms]
(pass) nooa search > lists files only [92.74ms]
(pass) nooa search > records telemetry [98.97ms]

src/features/pr/gh.test.ts:
(pass) GitHub Automation (gh.ts) > ghPrCreate success [0.50ms]
(pass) GitHub Automation (gh.ts) > ghPrCreate failure
(pass) GitHub Automation (gh.ts) > ghPrList
(pass) GitHub Automation (gh.ts) > ghPrDiff
(pass) GitHub Automation (gh.ts) > ghMergePr (squash)
(pass) GitHub Automation (gh.ts) > ghMergePr (rebase)
(pass) GitHub Automation (gh.ts) > ghMergePr (merge)
(pass) GitHub Automation (gh.ts) > ghClosePr
(pass) GitHub Automation (gh.ts) > ghCommentPr
(pass) GitHub Automation (gh.ts) > ghStatusPr [0.53ms]

src/features/pr/cli.test.ts:
(pass) nooa pr > pr --help shows usage [93.73ms]
(pass) nooa pr > merge requires pr number [89.25ms]
(pass) nooa pr > close requires pr number [91.08ms]
(pass) nooa pr > comment requires pr number [89.55ms]
(pass) nooa pr > status requires pr number [89.06ms]
(pass) nooa pr > merge uses gh and validates pr number [89.71ms]
(pass) nooa pr > status uses gh and validates pr number [91.68ms]

src/features/push/cli.test.ts:
(pass) nooa push > shows help [93.81ms]
(pass) nooa push > fails when working tree is dirty [136.79ms]
(pass) nooa push > pushes to remote [238.20ms]

src/features/guardrail/schemas.test.ts:
(pass) Guardrail Schemas > PatternSchema > should validate a literal pattern [0.70ms]
(pass) Guardrail Schemas > PatternSchema > should validate a regex pattern [0.02ms]
(pass) Guardrail Schemas > PatternSchema > should default type to literal [0.04ms]
(pass) Guardrail Schemas > PatternSchema > should reject invalid type [0.24ms]
(pass) Guardrail Schemas > PatternSpecSchema > should validate anyOf patterns [0.23ms]
(pass) Guardrail Schemas > PatternSpecSchema > should validate allOf patterns
(pass) Guardrail Schemas > PatternSpecSchema > should accept empty spec
(pass) Guardrail Schemas > RefactorRuleSchema > should validate a complete rule [0.40ms]
(pass) Guardrail Schemas > RefactorRuleSchema > should reject rule without id [0.08ms]
(pass) Guardrail Schemas > RefactorRuleSchema > should default severity to medium
(pass) Guardrail Schemas > RefactorProfileSchema > should validate a complete profile [0.31ms]
(pass) Guardrail Schemas > RefactorProfileSchema > should reject profile without name [0.03ms]
(pass) Guardrail Schemas > RefactorProfileSchema > should reject profile without rules

src/features/guardrail/engine.test.ts:
(pass) GuardrailEngine > evaluate > should find TODO patterns in files [21.48ms]
(pass) GuardrailEngine > evaluate > should respect scope.exclude patterns [17.64ms]
(pass) GuardrailEngine > evaluate > should return findings with correct structure [17.36ms]
(pass) GuardrailEngine > evaluate > requires all patterns in allOf within same file [25.65ms]
fatal: not a git repository (or any of the parent directories): .git
(pass) GuardrailEngine > evaluate > falls back to scanning files when not a git repo [14.73ms]
(pass) GuardrailEngine > determinism > should produce identical findings on repeated runs [49.11ms]
(pass) GuardrailEngine > determinism > should return findings sorted by rule, file, line [22.61ms]

src/features/guardrail/builtin-rules.test.ts:
(pass) Built-in Profiles > Profile Loading > should load zero-preguica profile [8.32ms]
(pass) Built-in Profiles > Profile Loading > should load security profile [4.62ms]
(pass) Built-in Profiles > Profile Loading > should load dangerous-patterns profile [1.54ms]
(pass) Built-in Profiles > Profile Loading > should load semantic-sanitization profile [0.61ms]
(pass) Built-in Profiles > Zero-PreguiÃ§a Detection > should detect TODO violations [48.08ms]
(pass) Built-in Profiles > Zero-PreguiÃ§a Detection > should detect FIXME violations [46.38ms]
(pass) Built-in Profiles > Security Detection > should detect hardcoded secrets [368.94ms]
(pass) Built-in Profiles > Security Detection > should detect eval usage [359.27ms]
(pass) Built-in Profiles > Semantic Sanitization Detection > should detect regex-based sanitization [21.68ms]

src/features/guardrail/builtin.test.ts:
(pass) getBuiltinProfilesDir returns correct path
(pass) listBuiltinProfiles returns known profiles
(pass) loadBuiltinProfile loads a profile [1.85ms]

src/features/guardrail/profiles.test.ts:
(pass) Profile Loader > loadProfile > should load a valid NOOA-style profile [0.36ms]
(pass) Profile Loader > loadProfile > should throw on invalid YAML [0.37ms]
(pass) Profile Loader > loadProfile > should throw on non-existent file [0.09ms]
(pass) Profile Loader > validateProfile > should return valid: true for valid profile [0.48ms]
(pass) Profile Loader > validateProfile > should return valid: false with errors for invalid profile [0.31ms]
(pass) Profile Loader > normalizeToNooaFormat (Auditor compatibility) > should normalize Auditor-style identifiers to NOOA patterns [0.07ms]
(pass) Profile Loader > normalizeToNooaFormat (Auditor compatibility) > should pass through NOOA-style patterns unchanged
(pass) Profile Loader > normalizeToNooaFormat (Auditor compatibility) > should return empty spec for empty input

src/features/guardrail/anarchy-regression.test.ts:
(pass) Anarchy Baseline Profile > should load anarchy-baseline profile successfully [0.94ms]
(pass) Anarchy Baseline Profile > should validate anarchy-baseline profile schema [0.45ms]
(pass) Anarchy Baseline Profile > should have secret detection rules [1.26ms]
(pass) Anarchy Baseline Profile > should have dependency risk rules [0.85ms]
(pass) Anarchy Baseline Profile > should have test quality rules [0.85ms]

src/features/guardrail/cli.test.ts:
{"level":"error","event":"guardrail.failure","timestamp":1771227730487,"metadata":{"action":"check","error":"--profile or --spec is required for check","error_message":"--profile or --spec is required for check","error_stack":"Error: --profile or --spec is required for check\n    at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/core/command-builder.ts:359:10)\n    at async guardrailCli (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/guardrail/cli.ts:694:25)\n    at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/guardrail/cli.test.ts:51:9)\n    at processTicksAndRejections (native:7:39)"}}
(pass) Guardrail CLI > check fails without profile or spec [30.96ms]
(pass) Guardrail CLI > root help [30.46ms]
{"level":"info","event":"guardrail.success","timestamp":1771227730558,"metadata":{"action":"check"}}
(pass) Guardrail CLI > check with spec loads spec file [41.16ms]
{"level":"info","event":"guardrail.success","timestamp":1771227730589,"metadata":{"action":"init"}}
(pass) Guardrail CLI > init creates default profile [31.87ms]
Initialized .nooa/guardrails/ directory
{"level":"info","event":"guardrail.success","timestamp":1771227730623,"metadata":{"action":"init"}}
{"level":"info","event":"guardrail.success","timestamp":1771227730624,"metadata":{"action":"validate","profile":"/var/folders/_l/y_vlrgtn01n1dr23byr98ctr0000gn/T/nooa-guardrail-cli-Z1kJnw/.nooa/guardrails/profiles/default.yaml"}}
(pass) Guardrail CLI > validate passes for valid profile [34.82ms]
{"level":"error","event":"guardrail.failure","timestamp":1771227730655,"metadata":{"action":"validate","error":"--profile is required for validate","error_message":"--profile is required for validate","error_stack":"Error: --profile is required for validate\n    at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/core/command-builder.ts:359:10)\n    at async guardrailCli (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/guardrail/cli.ts:694:25)\n    at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/guardrail/cli.test.ts:108:9)\n    at processTicksAndRejections (native:7:39)"}}
(pass) Guardrail CLI > validate fails for missing profile [29.98ms]
{"level":"error","event":"guardrail.failure","timestamp":1771227730685,"metadata":{"action":"validate","profile":"/var/folders/_l/y_vlrgtn01n1dr23byr98ctr0000gn/T/nooa-guardrail-cli-Y68h30/.nooa/guardrails/profiles/invalid.yaml","error":"Profile invalid.","error_message":"Profile invalid.","error_stack":"Error: Profile invalid.\n    at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/core/command-builder.ts:359:10)\n    at async guardrailCli (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/guardrail/cli.ts:694:25)\n    at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/guardrail/cli.test.ts:121:9)\n    at processTicksAndRejections (native:7:39)"}}
(pass) Guardrail CLI > validate fails for invalid profile content [30.34ms]
Initialized .nooa/guardrails/ directory
{"level":"info","event":"guardrail.success","timestamp":1771227730714,"metadata":{"action":"init"}}
{"level":"info","event":"guardrail.success","timestamp":1771227730738,"metadata":{"action":"check","profile":"/var/folders/_l/y_vlrgtn01n1dr23byr98ctr0000gn/T/nooa-guardrail-cli-nkYFRc/.nooa/guardrails/profiles/default.yaml"}}
(pass) Guardrail CLI > check runs guardrail checks [53.71ms]
{"level":"info","event":"guardrail.success","timestamp":1771227730769,"metadata":{"action":"spec"}}
(pass) Guardrail CLI > spec init creates GUARDRAIL.md [30.58ms]
{"level":"info","event":"guardrail.success","timestamp":1771227730801,"metadata":{"action":"spec"}}
{"level":"error","event":"guardrail.failure","timestamp":1771227730802,"metadata":{"action":"spec","error":"GUARDRAIL.md references missing profiles: zero-preguica","error_message":"GUARDRAIL.md references missing profiles: zero-preguica","error_stack":"Error: GUARDRAIL.md references missing profiles: zero-preguica\n    at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/core/command-builder.ts:359:10)\n    at async guardrailCli (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/guardrail/cli.ts:694:25)\n    at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/guardrail/cli.test.ts:174:9)\n    at processTicksAndRejections (native:7:39)"}}
(pass) Guardrail CLI > spec validate checks profiles [32.66ms]
{"level":"error","event":"guardrail.failure","timestamp":1771227730832,"metadata":{"action":"unknown","error":"Unknown subcommand.","error_message":"Unknown subcommand.","error_stack":"Error: Unknown subcommand.\n    at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/core/command-builder.ts:359:10)\n    at async guardrailCli (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/guardrail/cli.ts:694:25)\n    at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/guardrail/cli.test.ts:187:9)\n    at processTicksAndRejections (native:7:39)"}}
(pass) Guardrail CLI > unknown subcommand shows help [30.39ms]
{"level":"info","event":"guardrail.success","timestamp":1771227730863,"metadata":{"action":"add"}}
(pass) Guardrail CLI > add creates new profile [31.16ms]
{"level":"error","event":"guardrail.failure","timestamp":1771227730894,"metadata":{"action":"add","error":"profile \"exists\" already exists","error_message":"profile \"exists\" already exists","error_stack":"Error: profile \"exists\" already exists\n    at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/core/command-builder.ts:359:10)\n    at async guardrailCli (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/guardrail/cli.ts:694:25)\n    at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/guardrail/cli.test.ts:233:9)\n    at processTicksAndRejections (native:7:39)"}}
(pass) Guardrail CLI > add fails if profile exists [30.28ms]
{"level":"info","event":"guardrail.success","timestamp":1771227730924,"metadata":{"action":"list"}}
(pass) Guardrail CLI > list displays available profiles [30.98ms]
{"level":"info","event":"guardrail.success","timestamp":1771227730957,"metadata":{"action":"show"}}
(pass) Guardrail CLI > show displays profile content [32.20ms]
{"level":"info","event":"guardrail.success","timestamp":1771227730987,"metadata":{"action":"remove"}}
(pass) Guardrail CLI > remove deletes profile [30.00ms]
{"level":"info","event":"guardrail.success","timestamp":1771227731016,"metadata":{"action":"spec"}}
{"level":"info","event":"guardrail.success","timestamp":1771227731016,"metadata":{"action":"spec"}}
(pass) Guardrail CLI > spec show lists enabled profiles [30.48ms]

src/features/guardrail/contracts.test.ts:
(pass) Guardrail Contracts > Severity > should have correct severity levels [0.01ms]
(pass) Guardrail Contracts > Severity > should have 5 severity levels [0.01ms]
(pass) Guardrail Contracts > Confidence > should have correct confidence levels
(pass) Guardrail Contracts > Confidence > should have 3 confidence levels [0.01ms]
(pass) Guardrail Contracts > Finding interface > should accept a valid finding [0.02ms]
(pass) Guardrail Contracts > Finding interface > should accept optional trace field [0.02ms]
(pass) Guardrail Contracts > GuardrailReport interface > should accept a valid report [0.02ms]
(pass) Guardrail Contracts > GuardrailReport interface > should have correct status values

src/features/guardrail/spec.test.ts:
(pass) Spec Parser > parseGuardrailSpec > should return defaults when no spec file exists
(pass) Spec Parser > parseGuardrailSpec > should parse profiles from spec [0.28ms]
(pass) Spec Parser > parseGuardrailSpec > should parse thresholds from spec [0.24ms]
(pass) Spec Parser > parseGuardrailSpec > should parse custom rules from spec [0.58ms]
(pass) Spec Parser > parseGuardrailSpec > should parse exclusions from spec [0.24ms]
(pass) Spec Parser > parseGuardrailSpec > parses custom rules without require() [0.30ms]
(pass) Spec Parser > parseGuardrailSpec > does not rely on require() for yaml parsing [0.10ms]
(pass) Spec Parser > buildProfileFromSpec > should build combined profile from spec [0.12ms]

src/features/prompt/manifest.test.ts:
(pass) prompt manifest builders > buildToolManifest embeds command descriptions [0.39ms]
(pass) prompt manifest builders > buildToolManifest appends tool hints when available [0.06ms]
(pass) prompt manifest builders > buildSkillManifest embeds skill descriptions [0.10ms]
(pass) prompt manifest builders > buildInjectionManifest embeds patterns [0.07ms]
(pass) prompt manifest builders > normalizeDescription strips imperative prefixes [0.01ms]

src/features/prompt/service.test.ts:
(pass) Prompt Service > createPrompt > creates new prompt file [1.80ms]
(pass) Prompt Service > createPrompt > fails if prompt already exists [0.59ms]
(pass) Prompt Service > createPrompt > rethrows non-ENOENT errors during check [0.26ms]
(pass) Prompt Service > deletePrompt > deletes existing prompt [0.55ms]
(pass) Prompt Service > deletePrompt > throws if prompt not found [0.34ms]
(pass) Prompt Service > editPrompt > applies patch to prompt [0.55ms]
(pass) Prompt Service > publishPrompt > bumps version and creates changelog [1.23ms]
(pass) Prompt Service > publishPrompt > updates existing changelog with new section [0.82ms]
(pass) Prompt Service > publishPrompt > updates existing section in changelog [0.89ms]

src/features/prompt/engine.test.ts:
(pass) PromptEngine > listPrompts returns valid prompts [0.71ms]
(pass) PromptEngine > listPrompts handles errors gracefully [0.46ms]
(pass) PromptEngine > loadPrompt parses correctly [0.29ms]
(pass) PromptEngine > parsePrompt throws on missing frontmatter [0.13ms]
(pass) PromptEngine > parsePrompt throws on invalid metadata [0.14ms]
(pass) PromptEngine > renderPrompt substitutes variables [0.18ms]
(pass) PromptEngine > renderPrompt includes agent context [0.21ms]
(pass) PromptEngine > renderPrompt includes injected context [0.17ms]
(pass) PromptEngine > bumpVersion increments version correctly [0.69ms]
(pass) PromptEngine > bumpVersion throws on invalid version [0.34ms]

src/features/prompt/assembler.test.ts:
(pass) PromptAssembler > assembles deterministically with single embedding call [18.74ms]
(pass) PromptAssembler > includes semantic candidates above the relaxed threshold [10.07ms]

src/features/prompt/assembler.context.test.ts:
(pass) PromptAssembler context > filters injection attempts and increments filteredCount [9.50ms]
(pass) PromptAssembler context > ignores injection patterns when embedding dimensions differ [9.23ms]
(pass) PromptAssembler context > skips injection filtering when using mock embedder [9.16ms]

src/features/prompt/cli.test.ts:
(pass) nooa prompt --help lists new subcommands [95.79ms]
(pass) nooa prompt create writes a new prompt [95.38ms]
(pass) nooa prompt edit applies patch from stdin [107.93ms]
(pass) nooa prompt delete removes prompt file [99.40ms]
(pass) nooa prompt publish bumps version and updates changelog [105.65ms]

src/features/ai/engine.test.ts:
(pass) AiEngine > complete() > registers and uses a provider [0.31ms]
(pass) AiEngine > complete() > throws error for missing provider [0.16ms]
{"level":"warn","event":"AI request failed (attempt 1/4), retrying in 130ms","timestamp":1771227731614,"metadata":{"error":"Transient failure"}}
{"level":"warn","event":"AI request failed (attempt 2/4), retrying in 15ms","timestamp":1771227731745,"metadata":{"error":"Transient failure"}}
(pass) AiEngine > complete() > retries on failure [147.70ms]
{"level":"warn","event":"Primary provider primary completed failed, falling back to secondary","timestamp":1771227731762,"metadata":{"error":"Transient failure"}}
(pass) AiEngine > complete() > falls back to secondary provider [0.13ms]
{"level":"warn","event":"Primary provider primary completed failed, falling back to secondary","timestamp":1771227731762,"metadata":{"error":"Transient failure"}}
(pass) AiEngine > complete() > rethrows error if fallback fails [0.16ms]
(pass) AiEngine > embed() > uses provider for embedding [0.06ms]
(pass) AiEngine > embed() > throws error for missing provider in embed
{"level":"warn","event":"AI request failed (attempt 1/3), retrying in 163ms","timestamp":1771227731762,"metadata":{"error":"Embed failure"}}
(pass) AiEngine > embed() > retries on embed failure [163.51ms]
{"level":"warn","event":"Primary provider p1 embed failed, falling back to p2","timestamp":1771227731926,"metadata":{"error":"Embed failure"}}
(pass) AiEngine > embed() > falls back in embed [0.26ms]

src/features/ai/cli.test.ts:
(pass) AI CLI > run returns error if prompt is missing [0.54ms]
(pass) AI CLI > run executes simple prompt via engine [0.18ms]
(pass) AI CLI > run respects provider and model flags [0.02ms]
(pass) AI CLI > run handles streaming (CLI mode)
(pass) AI CLI > run executes MCP tool if flags provided
(pass) AI CLI > run handles invalid MCP args JSON [0.37ms]

src/features/review/discovery.test.ts:
(pass) Test Discovery heuristic > finds test in same directory [62.23ms]
(pass) Test Discovery heuristic > finds test in root tests/ directory [63.11ms]
(pass) Test Discovery heuristic > returns empty array if no test found [63.38ms]

src/features/review/execute.test.ts:
(pass) executeReview > normalizes 'maintainability' category to 'arch' [16.24ms]
(pass) executeReview > defaults null file to input_path [12.89ms]

src/features/fix/events.test.ts:
Error: Issue description required.
{"level":"error","event":"fix.failure","timestamp":1771227732149,"metadata":{"error":"Issue description required.","error_message":"Issue description required.","error_stack":"Error: Issue description required.\n    at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/core/command-builder.ts:359:10)\n    at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/fix/events.test.ts:21:20)\n    at processTicksAndRejections (native:7:39)"}}
(pass) fix events > emits started and failed when issue is missing [1.17ms]

src/features/fix/execute.test.ts:
(pass) executeFix > should track telemetry and return ok in dry run [0.98ms]
(pass) executeFix > should carry out full fix loop (Stage 1-5) [0.48ms]
(pass) executeFix > should handle failures in stages [0.10ms]
(pass) executeFix > should handle error when goal or search fails [0.46ms]

src/features/fix/cli.test.ts:
(pass) fix CLI > should show help [97.39ms]
(pass) fix CLI > should output JSON [88.29ms]

src/features/gate/execute.test.ts:
(pass) Gate Execute > returns error for unknown gate [0.08ms]
(pass) Gate Execute > executes spec gate [0.15ms]
(pass) Gate Execute > executes test gate [0.02ms]
(pass) Gate Execute > executes dogfood gate
(pass) Gate Execute > handles checking failure [0.13ms]
(pass) Gate Execute > passes context correctly [0.04ms]

src/features/gate/cli.test.ts:
(pass) Gate CLI > run() handler > calls checkGate when action is check and id provided
(pass) Gate CLI > run() handler > returns help when action is missing (or not check)
(pass) Gate CLI > run() handler > returns error when id is missing
{"level":"info","event":"gate.success","timestamp":1771227732341}
(pass) Gate CLI > Command Execution (onSuccess/onFailure) > executes check and prints success [0.98ms]
{"level":"info","event":"gate.success","timestamp":1771227732342}
(pass) Gate CLI > Command Execution (onSuccess/onFailure) > executes check and prints failure [0.38ms]
{"level":"info","event":"gate.success","timestamp":1771227732342}
(pass) Gate CLI > Command Execution (onSuccess/onFailure) > prints help when gateId is help [0.38ms]
{"level":"info","event":"gate.success","timestamp":1771227732343}
(pass) Gate CLI > Command Execution (onSuccess/onFailure) > outputs JSON when requested [0.28ms]
{"level":"error","event":"gate.failure","timestamp":1771227732343,"metadata":{"error_message":"Gate ID is required (--id).","error_stack":"Error: Gate ID is required (--id).\n    at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/core/command-builder.ts:359:10)\n    at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/gate/cli.test.ts:137:22)\n    at processTicksAndRejections (native:7:39)"}}
(pass) Gate CLI > Command Execution (onSuccess/onFailure) > handles missing id error [0.44ms]
{"level":"error","event":"gate.failure","timestamp":1771227732343,"metadata":{"error_message":"Unknown","error_stack":"Error: Unknown\n    at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/core/command-builder.ts:359:10)\n    at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/gate/cli.test.ts:154:22)\n    at processTicksAndRejections (native:7:39)"}}
(pass) Gate CLI > Command Execution (onSuccess/onFailure) > handles unknown gate error [0.32ms]

src/features/index/index.integration.test.ts:
(pass) Index Feature Integration > semantic search quality regression (fixtures) [3.35ms]

src/features/index/index.test.ts:
(pass) Index Feature Execution (Unit) > clearIndex calls store.clear [0.04ms]
(pass) Index Feature Execution (Unit) > getIndexStats calls store.stats [0.05ms]
(pass) Index Feature Execution (Unit) > indexRepo recursively lists and indexes files [0.21ms]
(pass) Index Feature Execution (Unit) > executeSearch embeds query and searches store [0.06ms]
(pass) Index Feature Execution (Unit) > rebuildIndex calls clear and indexRepo
(pass) Index Feature Execution (Unit) > chunking logic with large text [0.02ms]
(pass) Index Feature Execution (Unit) > chunkText splits with overlap and respects line boundaries [0.11ms]
(pass) Index Feature Execution (Unit) > chunkText keeps top-level boundaries when markers exist
(pass) Index Feature Execution (Unit) > indexFile batches embedding calls [0.32ms]
(pass) Index Feature Execution (Unit) > executeSearch caches query embeddings with normalized keys [0.04ms]

src/features/index/execute.test.ts:
(pass) Index Execute Internals > LruCache > stores and retrieves values
(pass) Index Execute Internals > LruCache > returns undefined for missing keys
(pass) Index Execute Internals > LruCache > evicts oldest item when max size exceeded
(pass) Index Execute Internals > LruCache > updates recently used order on get
(pass) Index Execute Internals > LruCache > updates recently used order on set update
(pass) Index Execute Internals > listFiles > ignores specific directories [0.37ms]
(pass) Index Execute Internals > listFiles > filters by extension [0.02ms]
(pass) Index Execute Internals > embedChunks > uses batch embedding when possible
(pass) Index Execute Internals > embedChunks > falls back to individual embedding on batch mismatch
(pass) Index Execute Internals > embedChunks > handles errors in individual embedding [0.13ms]
(pass) Index Execute Internals > embedChunks > returns empty for empty chunks
(pass) Index Execute Internals > chunkText > chunks by size when no boundaries [0.29ms]
(pass) Index Execute Internals > chunkText > chunks by boundary [0.04ms]
(pass) Index Execute Internals > chunkText > handles empty input
(pass) Index Execute Internals > chunkText > sub-chunks large segments within boundaries [0.07ms]

src/features/index/cli.test.ts:
(pass) Index CLI > run() handler > calls indexRepo when action is repo [0.42ms]
(pass) Index CLI > run() handler > calls indexFile when action is file and path provided
(pass) Index CLI > run() handler > returns error when action is file but path missing
(pass) Index CLI > run() handler > calls clearIndex when action is clear
(pass) Index CLI > run() handler > calls getIndexStats when action is stats
(pass) Index CLI > run() handler > calls rebuildIndex when action is rebuild
(pass) Index CLI > run() handler > returns error when action is unknown
(pass) Index CLI > run() handler > returns error when action is missing
{"level":"error","event":"index.error","timestamp":1771227732354,"metadata":{"error_message":"Foo","error_stack":"Error: Foo\n    at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/index/cli.test.ts:116:9)\n    at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/index/cli.test.ts:114:55)"}}
(pass) Index CLI > run() handler > returns runtime_error when operation throws [0.30ms]
{"level":"info","event":"index.success","timestamp":1771227732355,"metadata":{"action":"repo"}}
(pass) Index CLI > Command Execution (onSuccess/onFailure) > executes repo command and prints output [0.78ms]
{"level":"info","event":"index.success","timestamp":1771227732355,"metadata":{"action":"file","path":"foo.ts"}}
(pass) Index CLI > Command Execution (onSuccess/onFailure) > executes file command and prints output [0.55ms]
{"level":"info","event":"index.success","timestamp":1771227732356,"metadata":{"action":"clear"}}
(pass) Index CLI > Command Execution (onSuccess/onFailure) > executes clear command and prints output [0.29ms]
{"level":"info","event":"index.success","timestamp":1771227732356,"metadata":{"action":"stats"}}
(pass) Index CLI > Command Execution (onSuccess/onFailure) > executes stats command and prints output [0.46ms]
{"level":"info","event":"index.success","timestamp":1771227732357,"metadata":{"action":"rebuild"}}
(pass) Index CLI > Command Execution (onSuccess/onFailure) > executes rebuild command and prints output [0.48ms]
{"level":"info","event":"index.success","timestamp":1771227732357,"metadata":{"action":"stats"}}
(pass) Index CLI > Command Execution (onSuccess/onFailure) > handles --json output [0.35ms]
{"level":"error","event":"index.failure","timestamp":1771227732358,"metadata":{"error":"Subcommand required.","error_message":"Subcommand required.","error_stack":"Error: Subcommand required.\n    at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/core/command-builder.ts:359:10)\n    at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/index/cli.test.ts:241:23)\n    at processTicksAndRejections (native:7:39)"}}
(pass) Index CLI > Command Execution (onSuccess/onFailure) > handles missing command error [0.48ms]
{"level":"error","event":"index.failure","timestamp":1771227732358,"metadata":{"action":"file","error":"File path required.","error_message":"File path required.","error_stack":"Error: File path required.\n    at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/core/command-builder.ts:359:10)\n    at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/index/cli.test.ts:254:23)\n    at processTicksAndRejections (native:7:39)"}}
(pass) Index CLI > Command Execution (onSuccess/onFailure) > handles missing path error [0.45ms]
{"level":"error","event":"index.error","timestamp":1771227732358,"metadata":{"error_message":"Boom","error_stack":"Error: Boom\n    at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/index/cli.test.ts:268:9)\n    at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/index/cli.test.ts:265:51)"}}
{"level":"error","event":"index.failure","timestamp":1771227732358,"metadata":{"action":"repo","error":"Index operation failed.","error_message":"Index operation failed.","error_stack":"Error: Index operation failed.\n    at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/core/command-builder.ts:359:10)\n    at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/index/cli.test.ts:271:23)\n    at processTicksAndRejections (native:7:39)"}}
(pass) Index CLI > Command Execution (onSuccess/onFailure) > handles generic error via runtime_error [0.42ms]
{"level":"info","event":"index.success","timestamp":1771227732359,"metadata":{"action":"unknown"}}
(pass) Index CLI > Command Execution (onSuccess/onFailure) > handles unknown success mode (default case) [0.40ms]

src/features/skills/manager.test.ts:
(pass) SkillManager > createSkill creates directory and main file [5.56ms]
(pass) SkillManager > listSkills returns all skills [1.68ms]
(pass) SkillManager > deleteSkill removes directory [0.43ms]
(pass) SkillManager > enable/disable skill [0.59ms]
(pass) SkillManager > updateSkill verifies existence [0.56ms]
(pass) SkillManager > showSkill handles frontmatter correctly [0.60ms]
(pass) SkillManager > parseFrontmatter edge cases [0.22ms]
(pass) SkillManager > listSkills handles empty root [0.28ms]

src/features/skills/cli.test.ts:
(pass) Skills CLI > list subcommand [0.10ms]
(pass) Skills CLI > list subcommand empty [0.23ms]
(pass) Skills CLI > add subcommand [0.02ms]
(pass) Skills CLI > add subcommand error on missing name [0.06ms]
(pass) Skills CLI > remove subcommand [0.05ms]
(pass) Skills CLI > remove subcommand error on missing name [0.01ms]
(pass) Skills CLI > enable subcommand
(pass) Skills CLI > enable subcommand error on missing name [0.05ms]
(pass) Skills CLI > disable subcommand
(pass) Skills CLI > disable subcommand error on missing name
(pass) Skills CLI > show subcommand
(pass) Skills CLI > show subcommand error on missing name
(pass) Skills CLI > update subcommand [0.18ms]
(pass) Skills CLI > update subcommand error on missing name [0.01ms]
(pass) Skills CLI > help output [0.02ms]

src/features/eval/engine.test.ts:
(pass) EvalEngine > builds system prompt with assembler and template [38.41ms]

src/features/eval/cli.test.ts:
(pass) nooa eval CLI extensions > help lists report/history/compare [123.12ms]
(pass) nooa eval CLI extensions > history prints matching entries [91.23ms]
(pass) nooa eval CLI extensions > report returns the latest entry [88.51ms]
(pass) nooa eval CLI extensions > compare shows score delta between entries [90.66ms]
(pass) assemble returns prompt json [131.06ms]

src/features/replay/graph.test.ts:
(pass) ReplayGraph > should initialize empty
(pass) ReplayGraph > should add a node [0.02ms]
(pass) ReplayGraph > should reject empty labels
(pass) ReplayGraph > should detect cycles in addEdge [0.19ms]
(pass) ReplayGraph > should allow impact edges (no cycle check enforced for impact yet)
(pass) ReplayGraph > should find impacted nodes for fix [0.23ms]

src/features/replay/cli.test.ts:
(pass) replay.run > fails when action is missing [3.15ms]
(pass) replay.run > add creates a node [1.06ms]
(pass) replay.run > link creates next edge and prevents cycles [0.74ms]
(pass) replay.run > fix creates node and impact edges [0.89ms]
(pass) replay.run > show returns summary [0.63ms]
(pass) replay.run > cli output is human-friendly without --json [102.70ms]

src/features/run/parser.test.ts:
(pass) pipeline parser > delimiter mode > splits by -- [0.53ms]
(pass) pipeline parser > delimiter mode > unescapes \-- in delimiter mode [0.01ms]
(pass) pipeline parser > delimiter mode > handles internal vs external
(pass) pipeline parser > string mode > parses quoted strings [0.37ms]
(pass) pipeline parser > string mode > unescapes \-- in string mode
(pass) pipeline parser > string mode > detects exec prefix

src/features/goal/execute.test.ts:
(pass) Goal Manager > can set and get goal [0.71ms]
(pass) Goal Manager > returns null if no goal exists [0.20ms]
(pass) Goal Manager > can clear a goal [0.49ms]
(pass) Goal Manager > clearGoal does nothing if file doesn't exist [0.15ms]

src/features/goal/cli.test.ts:
(pass) Goal CLI > goal --help shows usage [91.48ms]
(pass) Goal CLI > goal status --json outputs structured data [93.40ms]

src/features/cron/cli.test.ts:
(pass) nooa cron CLI > shows help output [95.75ms]
(pass) nooa cron CLI > add and lists jobs [189.14ms]
(pass) nooa cron CLI > list --json returns structured data [188.46ms]
(pass) nooa cron CLI > status, run, logs, and history work end-to-end [468.71ms]
(pass) nooa cron CLI > edit and remove commands enforce force and updates [461.87ms]

src/runtime/context/builder.test.ts:
(pass) ContextBuilder > builds system prompt from identity files [1.42ms]
(pass) ContextBuilder > includes tool definitions in prompt [0.35ms]
(pass) ContextBuilder > includes summary if provided [0.30ms]
(pass) ContextBuilder > builds full messages array [0.39ms]

src/runtime/security/command-guard.test.ts:
(pass) DangerousCommandGuard > blocks destructive commands > blocks: rm -rf / (bulk deletion) [0.01ms]
(pass) DangerousCommandGuard > blocks destructive commands > blocks: rm -rf ~ (home deletion)
(pass) DangerousCommandGuard > blocks destructive commands > blocks: sudo rm -rf /var (sudo deletion)
(pass) DangerousCommandGuard > blocks destructive commands > blocks: format C: (disk format)
(pass) DangerousCommandGuard > blocks destructive commands > blocks: mkfs.ext4 /dev/sda (filesystem create)
(pass) DangerousCommandGuard > blocks destructive commands > blocks: dd if=/dev/zero of=/dev/sda (disk image)
(pass) DangerousCommandGuard > blocks destructive commands > blocks: dd of=/dev/sda if=/dev/zero (disk image (inverted args))
(pass) DangerousCommandGuard > blocks destructive commands > blocks: :(){ :|:& };: (fork bomb)
(pass) DangerousCommandGuard > blocks destructive commands > blocks: shutdown -h now (system shutdown)
(pass) DangerousCommandGuard > blocks destructive commands > blocks: reboot (system reboot)
(pass) DangerousCommandGuard > blocks destructive commands > blocks: poweroff (system poweroff)
(pass) DangerousCommandGuard > allows safe commands > allows: ls -la (list files)
(pass) DangerousCommandGuard > allows safe commands > allows: cat README.md (read file)
(pass) DangerousCommandGuard > allows safe commands > allows: bun test (run tests)
(pass) DangerousCommandGuard > allows safe commands > allows: git status (git status)
(pass) DangerousCommandGuard > allows safe commands > allows: echo hello (echo)
(pass) DangerousCommandGuard > allows safe commands > allows: bun run check (lint check)
(pass) DangerousCommandGuard > allows safe commands > allows: npm install (npm install)
(pass) DangerousCommandGuard > provides human-readable reason for blocked commands [0.02ms]

src/runtime/agent/provider.test.ts:
(pass) AiEngineAgentProvider > maps engine completion into agent response without tool calls
(pass) AiEngineAgentProvider > converts tool role messages into assistant-compatible content

src/runtime/agent/loop.test.ts:
(pass) AgentLoop > processes a simple message without tool calls [1.18ms]
(pass) AgentLoop > executes tool calls and iterates until assistant final answer [0.68ms]
(pass) AgentLoop > stops with error after max iterations [0.54ms]

src/runtime/session/manager.test.ts:
(pass) SessionManager > creates a new session [0.47ms]
(pass) SessionManager > returns existing session [0.16ms]
(pass) SessionManager > adds messages to session [0.14ms]
(pass) SessionManager > saves and loads sessions (atomic) [0.38ms]
(pass) SessionManager > truncates history keeping last N [0.18ms]
(pass) SessionManager > manages summary [0.17ms]

tests/features/alias/cli.test.ts:
âœ… Alias "deploy" saved
(pass) alias dispatches stored command [105.65ms]
âœ… Alias "json-list" saved
(pass) alias appends invocation arguments [105.32ms]

tests/features/worktree/execute.unit.test.ts:
(pass) worktree execute unit tests > createWorktree > should create worktree successfully [0.84ms]
{"level":"error","event":"worktree.failure","timestamp":1771227734887,"metadata":{"trace_id":"8a64de9e-6253-4b14-b092-3623f4576cc0","error_message":"Branch name is required.","error_stack":"Error: Branch name is required.\n    at fail (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/worktree/execute.ts:532:39)\n    at createWorktree (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/worktree/execute.ts:106:9)\n    at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/tests/features/worktree/execute.unit.test.ts:73:23)\n    at processTicksAndRejections (native:7:39)"}}
(pass) worktree execute unit tests > createWorktree > should fail if branch is missing [0.52ms]
{"level":"error","event":"worktree.failure","timestamp":1771227734887,"metadata":{"trace_id":"3c8a8c52-3375-462d-bcf0-7ddeda0cd620","error_message":"Invalid branch name (check git naming rules).","error_stack":"Error: Invalid branch name (check git naming rules).\n    at fail (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/worktree/execute.ts:532:39)\n    at createWorktree (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/worktree/execute.ts:120:9)\n    at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/tests/features/worktree/execute.unit.test.ts:88:23)\n    at processTicksAndRejections (native:7:39)"}}
(pass) worktree execute unit tests > createWorktree > should fail if invalid branch name [0.39ms]
(pass) worktree execute unit tests > listWorktrees > should list entries [0.67ms]
{"level":"error","event":"worktree.failure","timestamp":1771227734888,"metadata":{"trace_id":"c2ac0b38-c346-449b-9d68-0a58d92a1b3a","error_message":"Failed","error_stack":"Error: Failed\n    at fail (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/worktree/execute.ts:532:39)\n    at listWorktrees (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/worktree/execute.ts:266:9)\n    at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/tests/features/worktree/execute.unit.test.ts:113:23)\n    at processTicksAndRejections (native:7:39)"}}
(pass) worktree execute unit tests > listWorktrees > should handle git failure [0.38ms]
(pass) worktree execute unit tests > worktreeInfo > should return info for existing branch [0.35ms]
{"level":"error","event":"worktree.failure","timestamp":1771227734889,"metadata":{"trace_id":"86948bf9-4de7-4dbe-b962-ac06a49c1516","error_message":"Branch name is required.","error_stack":"Error: Branch name is required.\n    at fail (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/worktree/execute.ts:532:39)\n    at worktreeInfo (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/worktree/execute.ts:290:9)\n    at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/tests/features/worktree/execute.unit.test.ts:128:25)\n    at processTicksAndRejections (native:7:39)"}}
(pass) worktree execute unit tests > worktreeInfo > should fail if branch missing in input [0.41ms]
{"level":"error","event":"worktree.failure","timestamp":1771227734889,"metadata":{"trace_id":"eeecaf02-5a9d-4613-b7ba-df2ebddae87f","error_message":"Worktree 'missing' not found.","error_stack":"Error: Worktree 'missing' not found.\n    at fail (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/worktree/execute.ts:532:39)\n    at worktreeInfo (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/src/features/worktree/execute.ts:310:9)\n    at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/tests/features/worktree/execute.unit.test.ts:133:25)\n    at processTicksAndRejections (native:7:39)"}}
(pass) worktree execute unit tests > worktreeInfo > should fail if worktree not found [0.42ms]
(pass) worktree execute unit tests > removeWorktree > should remove existing worktree [0.06ms]
(pass) worktree execute unit tests > pruneWorktrees > should prune
(pass) worktree execute unit tests > lockWorktree > should lock
(pass) worktree execute unit tests > lockWorktree > should unlocking [0.30ms]

tests/features/worktree/cli.unit.test.ts:
(pass) worktree CLI run() > should handle create action [0.23ms]
(pass) worktree CLI run() > should handle list action
(pass) worktree CLI run() > should handle remove action [0.08ms]
(pass) worktree CLI run() > should handle prune action
(pass) worktree CLI run() > should handle lock action
(pass) worktree CLI run() > should handle unlock action [0.11ms]
(pass) worktree CLI run() > should handle info action [0.08ms]
(pass) worktree CLI run() > should handle missing action [0.03ms]
(pass) worktree CLI run() > should handle help action

tests/features/workflow/cli.unit.test.ts:
(pass) workflow CLI unit tests > parseWorkflowInput > should parse run action correctly [0.11ms]
(pass) workflow CLI unit tests > parseWorkflowInput > should handle missing optional args [0.04ms]
(pass) workflow CLI unit tests > handleWorkflowSuccess > should print JSON if json flag is true
(pass) workflow CLI unit tests > handleWorkflowSuccess > should print help if help step failed (help mode)
(pass) workflow CLI unit tests > handleWorkflowSuccess > should print success message if ok
(pass) workflow CLI unit tests > handleWorkflowSuccess > should print failure message and set exit code if not ok [0.11ms]
(pass) workflow CLI unit tests > run > should call runWorkflow with parsed args [0.08ms]
(pass) workflow CLI unit tests > run > should return help if action is not run [0.04ms]

tests/features/workflow/execute.test.ts:
(pass) runWorkflow > should run default gates (spec, test, dogfood) when no gates provided
(pass) runWorkflow > should run specified gates
47 |         expect(result.data?.ok).toBe(true);
48 |     });
49 | 
50 |     it("should fail gracefully on unknown gate", async () => {
51 |         const result = await runWorkflow({ gates: ["unknown-gate"] }, mockGates);
52 |         expect(result.ok).toBe(false);
                               ^
error: expect(received).toBe(expected)

Expected: false
Received: true

      at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/tests/features/workflow/execute.test.ts:52:27)
(fail) runWorkflow > should fail gracefully on unknown gate [0.85ms]
59 |         bus.on("workflow.started", () => events.push("start"));
60 |         bus.on("workflow.completed", () => events.push("complete"));
61 | 
62 |         await runWorkflow({ bus }, mockGates);
63 | 
64 |         expect(events).toContain("start");
                            ^
error: expect(received).toContain(expected)

Expected to contain: "start"
Received: []

      at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/tests/features/workflow/execute.test.ts:64:24)
(fail) runWorkflow > should emit workflow events if bus is provided [0.30ms]
78 |             { gates: ["fail"] },
79 |             { fail: FailingGate }
80 |         );
81 | 
82 |         expect(result.ok).toBe(true); // runWorkflow returns ok even if step fails (it returns result in data)
83 |         expect(result.data?.ok).toBe(false);
                                     ^
error: expect(received).toBe(expected)

Expected: false
Received: true

      at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/test-coverage-boost-2/tests/features/workflow/execute.test.ts:83:33)
(fail) runWorkflow > should return failure if a gate fails

src/features/ai/providers/openai.test.ts:
(pass) OpenAiProvider > complete() sends correct request
(pass) OpenAiProvider > complete() throws on missing API key
(pass) OpenAiProvider > complete() throws on non-ok response
(pass) OpenAiProvider > complete() throws when no choices returned
(pass) OpenAiProvider > embed() sends correct request

src/features/ai/providers/ollama.test.ts:
(pass) OllamaProvider > complete() sends correct request [0.28ms]
(pass) OllamaProvider > complete() throws on error [0.10ms]
(pass) OllamaProvider > embed() sends correct request [0.11ms]
(pass) OllamaProvider > embed() throws on error [0.02ms]

src/features/eval/scorers/deterministic.test.ts:
(pass) DeterministicScorer > passes valid JSON check [0.03ms]
(pass) DeterministicScorer > extracts JSON from markdown
(pass) DeterministicScorer > handles invalid JSON
(pass) DeterministicScorer > skips checks if no valid JSON parsed
(pass) DeterministicScorer > verifies properties
(pass) DeterministicScorer > checks enums on arrays [0.38ms]
(pass) DeterministicScorer > fails on invalid enum value [0.02ms]
(pass) DeterministicScorer > detects absolute paths
(pass) DeterministicScorer > verifies max_count
(pass) DeterministicScorer > verifies max_count success
(pass) DeterministicScorer > verifies property_equals
(pass) DeterministicScorer > handles missing property or limit for max_count
(pass) DeterministicScorer > handles missing property for property_equals
(pass) DeterministicScorer > handles edge cases in getValues
(pass) DeterministicScorer > handles general errors during check

3 tests failed:
(fail) runWorkflow > should fail gracefully on unknown gate [0.85ms]
(fail) runWorkflow > should emit workflow events if bus is provided [0.30ms]
(fail) runWorkflow > should return failure if a gate fails
--------------------------------------------|---------|---------|-------------------
File                                        | % Funcs | % Lines | Uncovered Line #s
--------------------------------------------|---------|---------|-------------------
All files                                   |   71.92 |   79.15 |
 scripts/generate-docs.ts                   |   83.33 |   58.26 | 20-22,86-129
 src/core/cli-flags.ts                      |  100.00 |  100.00 | 
 src/core/cli-output.ts                     |  100.00 |  100.00 | 
 src/core/command-builder.ts                |   89.66 |   94.72 | 160-161,276-287
 src/core/db/cron_store.ts                  |  100.00 |  100.00 | 
 src/core/db/index.ts                       |  100.00 |  100.00 | 
 src/core/db/schema/cron.ts                 |  100.00 |  100.00 | 
 src/core/db/schema/cron_jobs.ts            |  100.00 |   75.86 | 51-53,55-58
 src/core/db/schema/cron_logs.ts            |  100.00 |  100.00 | 
 src/core/db/schema/embeddings.ts           |  100.00 |  100.00 | 
 src/core/db/schema/mcp_aliases.ts          |  100.00 |  100.00 | 
 src/core/db/schema/mcp_servers.ts          |  100.00 |  100.00 | 
 src/core/db/store.ts                       |  100.00 |  100.00 | 
 src/core/event-bus.ts                      |   75.00 |  100.00 | 
 src/core/help-builder.ts                   |   83.33 |   68.42 | 49-60
 src/core/integrations/git.ts               |    0.00 |    7.14 | 3-22,27-32
 src/core/integrations/github.ts            |  100.00 |  100.00 | 
 src/core/io.ts                             |  100.00 |   96.72 | 79-80
 src/core/logger.ts                         |  100.00 |  100.00 | 
 src/core/mcp/Client.ts                     |   95.45 |   96.43 | 178-181
 src/core/mcp/ConfigStore.ts                |  100.00 |  100.00 | 
 src/core/mcp/Registry.ts                   |  100.00 |  100.00 | 
 src/core/mcp/ServerManager.ts              |   91.67 |  100.00 | 
 src/core/mcp/ToolProvider.ts               |  100.00 |  100.00 | 
 src/core/mcp/alias.ts                      |  100.00 |  100.00 | 
 src/core/mcp/db.ts                         |  100.00 |  100.00 | 
 src/core/mcp/integrations/ai.ts            |    0.00 |   10.00 | 17-28,36-59
 src/core/mcp/integrations/context.ts       |    0.00 |    0.00 | 21-40
 src/core/memory/schema.ts                  |  100.00 |   93.75 | 
 src/core/policy/PolicyEngine.ts            |  100.00 |  100.00 | 
 src/core/reflection/hook.ts                |  100.00 |   95.24 | 20-21
 src/core/registry.ts                       |   85.71 |  100.00 | 
 src/core/skills/Discovery.ts               |  100.00 |  100.00 | 
 src/core/telemetry.ts                      |  100.00 |  100.00 | 
 src/core/types.ts                          |  100.00 |  100.00 | 
 src/core/workflow/Engine.ts                |   66.67 |  100.00 | 
 src/core/workflow/gates.ts                 |    0.00 |   16.85 | 8-35,42-57,65-94
 src/core/workflow/gates/DogfoodGate.ts     |    0.00 |   50.00 | 5-8
 src/core/workflow/gates/SpecGate.ts        |   66.67 |  100.00 | 
 src/core/workflow/gates/TestGate.ts        |    0.00 |   50.00 | 5-8
 src/core/worktree/Pool.ts                  |  100.00 |  100.00 | 
 src/features/act/cli.ts                    |   73.33 |   92.12 | 163-167,233-237,291-298
 src/features/act/engine.ts                 |   93.33 |   89.22 | 193-214
 src/features/agent/cli.ts                  |    0.00 |   67.44 | 65-67,86-103,107-111,114
 src/features/agent/engine.ts               |    0.00 |   21.43 | 28-33,37,41-77
 src/features/ai/cli.ts                     |   55.56 |   81.64 | 203-207,267-271,297-304,308-334,337
 src/features/ai/engine.ts                  |   85.71 |   73.11 | 53-84
 src/features/ai/providers/groq.ts          |    0.00 |    1.79 | 11-175
 src/features/ai/providers/mock.ts          |   75.00 |   82.35 | 57-68
 src/features/ai/providers/mod.ts           |  100.00 |  100.00 | 
 src/features/ai/providers/ollama.ts        |   66.67 |   42.86 | 52-127
 src/features/ai/providers/openai.ts        |   71.43 |   44.87 | 65-150
 src/features/ask/cli.ts                    |   25.00 |   66.41 | 95-98,106-110,131-141,145-154,157-162,167-169,171-173
 src/features/chat/cli.ts                   |   25.00 |   80.00 | 164-168,172-176,179-189,194-196,198-200
 src/features/chat/execute.ts               |  100.00 |  100.00 | 
 src/features/check/cli.ts                  |    0.00 |   31.19 | 123-131,135-201,223-226,230-242,245-284,289-292,294-297,302,307-350,354-365,369-384
 src/features/ci/cli.ts                     |    0.00 |   50.68 | 99-113,134-136,140-183,186-190,195-197,199-200
 src/features/ci/execute.ts                 |  100.00 |   86.60 | 29-36,47-51
 src/features/code/cli.ts                   |   88.89 |   89.40 | 184-187,199-200,204-214,218-228,233-239,423
 src/features/code/diff.ts                  |  100.00 |  100.00 | 
 src/features/code/format.ts                |  100.00 |  100.00 | 
 src/features/code/patch.ts                 |  100.00 |   96.92 | 20
 src/features/code/refactor.ts              |  100.00 |  100.00 | 
 src/features/code/write.ts                 |  100.00 |  100.00 | 
 src/features/commit/cli.ts                 |    0.00 |   31.54 | 125-250,272-276,280-288,291-349,354-355,357-358
 src/features/commit/guards.ts              |    0.00 |   30.56 | 10,14-15,19-20,24-25,29-46
 src/features/context/cli.ts                |    0.00 |   49.41 | 106-147,168-170,174-190,193-209,214-216,218-220
 src/features/context/engine.ts             |   88.89 |   98.08 | 
 src/features/context/execute.ts            |  100.00 |  100.00 | 
 src/features/cron/cli.ts                   |    0.00 |   24.84 | 179-181,185-194,198-453,488-520,524-544,547-575,580-582,584-587
 src/features/cron/service.ts               |    9.09 |   39.02 | 23-28,32,36,40,44,48,52,56,60-70
 src/features/doctor/cli.ts                 |    0.00 |   46.67 | 97-116,132-133,137-183,186-190,195-197,199-200
 src/features/doctor/execute.ts             |  100.00 |   96.49 | 37
 src/features/embed/cli.ts                  |   90.00 |   91.42 | 298-315,365-371
 src/features/embed/engine.ts               |  100.00 |   95.24 | 53
 src/features/eval/cli.ts                   |    0.00 |   17.67 | 158-507,538-554,558-674,677-704,709-712,714-718
 src/features/eval/engine.ts                |   50.00 |   19.67 | 84-275
 src/features/eval/history.ts               |    0.00 |   11.76 | 18-25,29-52,57-69
 src/features/eval/scorers/deterministic.ts |   85.71 |   91.61 | 53-64
 src/features/fix/cli.ts                    |   66.67 |   63.54 | 118,120-133,172-216,230-231,235-237
 src/features/fix/execute.ts                |  100.00 |  100.00 | 
 src/features/gate/cli.ts                   |  100.00 |  100.00 | 
 src/features/gate/execute.ts               |  100.00 |  100.00 | 
 src/features/goal/cli.ts                   |    0.00 |   44.52 | 96-146,162-164,168-182,185-195,200-201,203-205
 src/features/goal/execute.ts               |  100.00 |  100.00 | 
 src/features/guardrail/builtin.ts          |  100.00 |  100.00 | 
 src/features/guardrail/cli.ts              |   94.12 |   86.21 | 202-205,251,368-374,438-444,465,467-470,476-482,525-531,534-540,559-560,605-607,613,615,635,639-641,660,662-666,668-669,685,768-778
 src/features/guardrail/contracts.ts        |  100.00 |  100.00 | 
 src/features/guardrail/engine.ts           |   93.75 |  100.00 | 
 src/features/guardrail/profiles.ts         |  100.00 |   86.21 | 33,56,103-105,110-112
 src/features/guardrail/schemas.ts          |  100.00 |  100.00 | 
 src/features/guardrail/spec.ts             |  100.00 |   98.23 | 97-98
 src/features/identity/cli.ts               |    0.00 |   68.09 | 79-95,111-112,116-123,126-127
 src/features/identity/init.ts              |  100.00 |  100.00 | 
 src/features/identity/templates.ts         |  100.00 |  100.00 | 
 src/features/ignore/cli.ts                 |   90.91 |   98.91 | 319,322
 src/features/ignore/execute.ts             |  100.00 |  100.00 | 
 src/features/index/cli.ts                  |   88.89 |   99.45 | 
 src/features/index/execute.ts              |  100.00 |  100.00 | 
 src/features/init/cli.ts                   |    0.00 |   40.91 | 128-165,196-273,277-298,301,306-308
 src/features/init/execute.ts               |  100.00 |  100.00 | 
 src/features/mcp/alias.ts                  |  100.00 |   83.56 | 21,31-32,46-47,50-51,66,79-80,85
 src/features/mcp/call.ts                   |  100.00 |   88.61 | 34,46-47,54-55,76-77,99-100
 src/features/mcp/cli.ts                    |   90.91 |   88.16 | 113-116,136-140,173-175,182-186
 src/features/mcp/configure.ts              |  100.00 |   90.43 | 31,43-44,49-50,54-55,63-64
 src/features/mcp/disable.ts                |  100.00 |   94.29 | 38-39
 src/features/mcp/enable.ts                 |  100.00 |   94.29 | 38-39
 src/features/mcp/health.ts                 |  100.00 |   88.00 | 17,24-25,50-51
 src/features/mcp/helpers.ts                |  100.00 |   92.86 | 9,49,78,88-89
 src/features/mcp/info.ts                   |  100.00 |   65.22 | 17,25-26,31-32,40-41,46-54
 src/features/mcp/init.ts                   |   90.00 |   99.36 | 
 src/features/mcp/install.ts                |  100.00 |   93.33 | 62-65
 src/features/mcp/list.ts                   |  100.00 |   71.74 | 40-52
 src/features/mcp/loader.ts                 |  100.00 |   12.90 | 3-29
 src/features/mcp/marketplace.ts            |  100.00 |   83.67 | 19-20,50,57,79,87-88,98,116-117,126-131
 src/features/mcp/resource.ts               |  100.00 |   80.00 | 18,26-27,33-34,43-44,55,60-61
 src/features/mcp/test-utils.ts             |  100.00 |  100.00 | 
 src/features/mcp/test.ts                   |  100.00 |   79.59 | 18,25-26,31-32,41-42,53,58-59
 src/features/mcp/uninstall.ts              |  100.00 |   79.49 | 17,24-25,30-31,39-40
 src/features/memory/cli.ts                 |    0.00 |   27.64 | 166-169,173-175,179-336,364-399,403-472,476-485,490-492,494-496
 src/features/memory/engine.ts              |   72.73 |   50.20 | 81-161,208-236,285-299
 src/features/memory/reflect.ts             |  100.00 |  100.00 | 
 src/features/memory/summarize.ts           |  100.00 |   98.36 | 
 src/features/pr/cli.ts                     |    0.00 |   30.53 | 160-292,317-329,333-397,401-408,414-416
 src/features/pr/gh.ts                      |  100.00 |  100.00 | 
 src/features/prompt/assembler.ts           |   88.68 |   98.37 | 81,108,222-224
 src/features/prompt/cli.ts                 |    0.00 |   25.17 | 174-180,184-390,419-431,435-500,504-533,539-541
 src/features/prompt/config.ts              |  100.00 |  100.00 | 
 src/features/prompt/engine.ts              |  100.00 |  100.00 | 
 src/features/prompt/injection.ts           |  100.00 |  100.00 | 
 src/features/prompt/manifest.ts            |  100.00 |  100.00 | 
 src/features/prompt/service.ts             |  100.00 |   98.92 | 
 src/features/push/cli.ts                   |    0.00 |   28.80 | 125-233,253-257,261-269,272-344,349-350,352-353,358,363-386
 src/features/push/guards.ts                |    0.00 |   18.75 | 3,7-8,12-21
 src/features/pwd/cli.ts                    |   33.33 |   87.72 | 88,92-96
 src/features/read/cli.ts                   |   88.89 |   98.84 | 217
 src/features/replay/cli.ts                 |   25.00 |   60.39 | 145-148,152-155,158-161,166-169,172-175,233-238,243-258,268,270-272,292-337,341-365,368,374-376
 src/features/replay/graph.ts               |   91.67 |   99.00 | 
 src/features/replay/storage.ts             |  100.00 |   96.00 | 
 src/features/review/cli.ts                 |    0.00 |   40.53 | 130-173,196-202,206-252,255-284,289-291,293-295
 src/features/review/discovery.ts           |  100.00 |   97.37 | 
 src/features/review/execute.ts             |  100.00 |   88.39 | 62-63,67-69,71-72,77-80,84,98,177-180
 src/features/run/cli.ts                    |    0.00 |   39.65 | 134,138-193,217-232,236-250,253-293,298-301,303-305
 src/features/run/executor.ts               |    0.00 |    2.61 | 13-98,102-109,113-130
 src/features/run/parser.ts                 |  100.00 |  100.00 | 
 src/features/scaffold/cli.ts               |    0.00 |   37.09 | 140-143,148-220,247-253,257-297,300-336,341-346,348-351
 src/features/scaffold/engine.ts            |    0.00 |    6.33 | 15-88
 src/features/scaffold/execute.ts           |    0.00 |    4.21 | 16-106
 src/features/search/cli.ts                 |    0.00 |   46.46 | 115-117,121-122,152-213,245-259,263-287,290-293,298-302,304-307
 src/features/search/engine.ts              |  100.00 |   90.09 | 42,44-54,114,143,147,150,178,229,237,298-300
 src/features/skills/cli.ts                 |   33.33 |   78.00 | 108-111,219-221,225-254,258-263
 src/features/skills/manager.ts             |   94.74 |  100.00 | 
 src/features/skills/templates.ts           |  100.00 |  100.00 | 
 src/features/tui/cli.ts                    |   66.67 |   95.92 | 86-87
 src/features/workflow/cli.ts               |   85.71 |   99.10 | 
 src/features/workflow/execute.ts           |    0.00 |   11.54 | 35-103
 src/features/worktree/cli.ts               |   71.43 |   74.70 | 270,272,274-289,318-327,350-352,356-382,400-401,413-428,430,433-438
 src/features/worktree/execute.ts           |  100.00 |  100.00 | 
 src/features/worktree/git.ts               |  100.00 |  100.00 | 
 src/runtime/agent/loop.ts                  |  100.00 |  100.00 | 
 src/runtime/agent/provider.ts              |  100.00 |  100.00 | 
 src/runtime/context/builder.ts             |  100.00 |  100.00 | 
 src/runtime/security/command-guard.ts      |   50.00 |  100.00 | 
 src/runtime/session/manager.ts             |  100.00 |  100.00 | 
 src/runtime/tool-registry.ts               |  100.00 |  100.00 | 
 src/runtime/types.ts                       |  100.00 |  100.00 | 
 src/scripts/measure-prompt-stats.ts        |   60.00 |   76.67 | 40-42,44-46
 src/test-utils/cli-env.ts                  |  100.00 |  100.00 | 
 tmp_features/bar/cli.ts                    |    0.00 |  100.00 | 
 tmp_features/baz/cli.ts                    |  100.00 |  100.00 | 
 tmp_features/foo/cli.ts                    |    0.00 |  100.00 | 
--------------------------------------------|---------|---------|-------------------

 721 pass
 3 fail
 1511 expect() calls
Ran 724 tests across 142 files. [17.16s]
