bun test v1.3.6 (d530ed99)

index.nooa.test.ts:
(pass) nooa root > nooa --help shows root usage and subcommands [81.15ms]
(pass) nooa root > nooa --version prints 0.0.1 [75.46ms]
(pass) nooa root > package.json exposes nooa bin [0.25ms]

tests/contract.test.ts:
(pass) NOOA Contract Tests > Init Contract > should create .nooa directory and core files [10.09ms]
(pass) NOOA Contract Tests > Init Contract > should fail if .nooa already exists without --force [0.68ms]
(pass) NOOA Contract Tests > Init Contract > should succeed if .nooa already exists with --force [2.54ms]
(pass) NOOA Contract Tests > Prompt Injection Contract > should follow precedence: constitution -> soul -> user -> memory [1.51ms]
(pass) NOOA Contract Tests > Prompt Injection Contract > should truncate content when budgets are exceeded [0.65ms]
(pass) NOOA Contract Tests > Memory Contract > should generate valid YAML entries [44.04ms]
(pass) NOOA Contract Tests > Memory Contract > should promote entries to durable memory [15.12ms]
(pass) NOOA Contract Tests > Reflection Contract > should only reflect on material events [1.22ms]
(pass) NOOA Contract Tests > Reflection Contract > should reflect on material events [52.70ms]
(pass) NOOA Contract Tests > Reflection Contract > should cap reflections at 3 per session [121.74ms]
(pass) NOOA Contract Tests > Locking Contract > should prevent concurrent writes to memory [79.45ms]

src/core/telemetry.test.ts:
(pass) TelemetryStore > tracks events in sqlite [1.76ms]
(pass) TelemetryStore > filters by level and trace_id [1.87ms]
(pass) TelemetryStore > reopens database if closed [1.70ms]

src/core/registry.test.ts:
(pass) CommandRegistry > registers and retrieves a command
(pass) CommandRegistry > lists registered commands

src/core/io.test.ts:
(pass) IO Utilities > runWithStdin provides mock constant content [0.37ms]
(pass) IO Utilities > getStdinText returns empty string when TTY [0.02ms]
(pass) IO Utilities > getStdinText reads from non-TTY stream async iterator [0.25ms]
(pass) IO Utilities > getStdinText handles async iterator error
(pass) IO Utilities > getStdinText handles stream events [1.73ms]
(pass) IO Utilities > getStdinText handles stream timeout [200.99ms]
(pass) IO Utilities > getStdinText handles stream error [1.19ms]

src/core/loader.test.ts:
no export
(pass) Command Loader > loads commands from directory [1.97ms]

src/core/logger.test.ts:
(pass) Logger > createTraceId returns string
(pass) Logger > createTraceId fallback [0.07ms]
(pass) Logger > basic logging [0.13ms]
(pass) Logger > levels [0.03ms]
(pass) Logger > async context
(pass) Logger > setContext / clearContext (async) [0.19ms]
(pass) Logger > sync context fallback [0.04ms]
(pass) Logger > createLogger factory
(pass) Logger > default writer uses stderr [0.13ms]

src/core/event-bus.test.ts:
(fail) EventBus > publishes events to subscribers [5000.08ms]
  ^ this test timed out after 5000ms, before its done callback was called. If a done callback was not intended, remove the last parameter from the test callback function
(fail) EventBus > unsubscribes from events [5000.00ms]
  ^ this test timed out after 5000ms, before its done callback was called. If a done callback was not intended, remove the last parameter from the test callback function
(fail) EventBus > handles off with non-existent event [5000.05ms]
  ^ this test timed out after 5000ms, before its done callback was called. If a done callback was not intended, remove the last parameter from the test callback function
(fail) EventBus > handles emit with no subscribers [5000.00ms]
  ^ this test timed out after 5000ms, before its done callback was called. If a done callback was not intended, remove the last parameter from the test callback function

tests/core/cohesion.test.ts:
(pass) Command Cohesion Contract > Command: prompt > prompt should support --help and return exit 0 [203.17ms]
(pass) Command Cohesion Contract > Command: prompt > prompt should NOT have logs in stdout when --json is used [261.76ms]
(pass) Command Cohesion Contract > Command: prompt > prompt should record telemetry success or failure [115.55ms]
(pass) Command Cohesion Contract > Command: review > review should support --help and return exit 0 [119.00ms]
(pass) Command Cohesion Contract > Command: review > review should NOT have logs in stdout when --json is used [240.60ms]
(pass) Command Cohesion Contract > Command: review > review should record telemetry success or failure [126.85ms]
(pass) Command Cohesion Contract > search should validate max-results and return exit 2 [111.38ms]

src/core/memory/schema.test.ts:
(pass) Memory Schema > formatMemoryAsMarkdown produces valid YAML [0.34ms]
(pass) Memory Schema > parseMemoryFromMarkdown reverses format
(pass) Memory Schema > parseMemoryFromMarkdown throws on invalid format [0.19ms]
(pass) Memory Schema > parseMemoryFromMarkdown handles missing content [0.08ms]

src/core/mcp/ConfigStore.test.ts:
(pass) ConfigStore can save and load MCP config [0.41ms]
(pass) ConfigStore can update existing MCP config [0.12ms]
(pass) ConfigStore can list all servers
(pass) ConfigStore can delete a server [0.26ms]
(pass) ConfigStore returns undefined for non-existent server

src/core/mcp/types.test.ts:
(pass) McpServer type is defined [0.06ms]
(pass) McpTool type is defined [0.02ms]
(pass) McpResource type is defined
(pass) McpPrompt type is defined [0.02ms]

src/core/mcp/ServerManager.test.ts:
(pass) ServerManager can start a server [22.61ms]
(pass) ServerManager tracks running servers [21.07ms]
(pass) ServerManager can stop a specific server [21.14ms]
(pass) ServerManager can get running client [21.74ms]
(pass) ServerManager stops all servers on stopAll [39.40ms]
(pass) ServerManager returns list of running servers [22.97ms]

src/core/mcp/alias.test.ts:
(pass) aliases persist metadata and respect deletion [2.14ms]

src/core/mcp/Registry.test.ts:
(pass) Registry.healthCheck returns healthy status [23.67ms]
(pass) Registry.healthCheck marks disabled servers as down [2.28ms]

src/core/mcp/Client.test.ts:
(pass) callTool retries until transient failures resolve [3.83ms]
(pass) callTool throws after max retries [3.56ms]
(pass) Client methods delegate to sendRequest [0.12ms]
(pass) Real Client flow with mock process [0.02ms]

src/core/mcp/ToolProvider.test.ts:
(pass) ToolProvider can get tools from enabled MCPs [23.30ms]
(pass) ToolProvider can execute a tool [23.22ms]
(pass) ToolProvider returns empty array for no enabled MCPs [0.35ms]

src/core/integrations/github.test.ts:
(pass) GitHubClient > requestJson handles success
(pass) GitHubClient > requestJson handles API error with message [0.20ms]
(pass) GitHubClient > requestJson handles API error without valid json
(pass) GitHubClient > createPR sends correct body
(pass) GitHubClient > getPRDiff returns text
(pass) GitHubClient > getPRDiff throws on failure [0.15ms]
(pass) GitHubClient > mergePR uses correct method [0.09ms]
(pass) GitHubClient > closePR sends closed state
(pass) GitHubClient > commentPR sends body
(pass) GitHubClient > getPRStatus aggregates info, approvals and checks [0.29ms]
(pass) GitHubClient > getPRStatus handles missing labels or sha

src/core/db/embeddings.test.ts:
(pass) Embeddings Schema > creates embeddings table [0.33ms]

src/core/db/index.test.ts:
(pass) Store > initializes tables [0.45ms]
(pass) Store > stores and searches embeddings [0.46ms]
(pass) Store > cosine similarity works [0.29ms]
(pass) Store > handles zero vectors [0.11ms]
(pass) Store > handles dimension mismatch [0.23ms]
(pass) Store > updates embedding on conflict [0.20ms]
(pass) Store > clear removes all [0.07ms]

src/core/db/cron.test.ts:
(pass) Cron DB Schema > can create cron_jobs and cron_logs tables [0.37ms]

src/core/db/cron_store.test.ts:
(pass) CronStore > creates the cron_jobs table and persists jobs [0.38ms]
(pass) CronStore > getByName returns the job when exists [0.18ms]
(pass) CronStore > delete and toggle jobs behave consistently
(pass) CronStore > recordExecution logs runs and listLogs returns entries [0.42ms]

src/core/skills/Discovery.test.ts:
(pass) Discovery > lists available skills in directory [0.81ms]

src/core/policy/PolicyEngine.test.ts:
(pass) PolicyEngine > identifies forbidden markers [0.78ms]
(pass) PolicyEngine > respects nooa-ignore comment [0.45ms]
(pass) PolicyEngine > respects .nooa-ignore file [0.39ms]
(pass) PolicyEngine > ignores non-source files and tests [0.28ms]
(pass) PolicyEngine > checkFiles aggregates results [0.44ms]
(pass) PolicyEngine > handles file read errors gracefully [0.24ms]

src/core/reflection/hook.test.ts:
(pass) Auto Reflection Hook > autoReflect adds observable memory entry [1.19ms]
{"level":"warn","event":"memory.embedding_failed","timestamp":1770093570246,"metadata":{"error":"Embed provider returned no embedding"}}
(pass) Auto Reflection Hook > autoReflect skips excluded commands (e.g. reflection itself) [1.35ms]

src/features/commit/cli.test.ts:
(pass) nooa commit > shows help [114.24ms]
(pass) nooa commit > blocks TODO markers by default [231.45ms]
(pass) nooa commit > runs tests by default [273.42ms]

src/features/context/execute.test.ts:
(pass) Context Builder > extracts context for a given file [0.57ms]
(pass) Context Builder > falls back to symbol lookup when file not found [0.18ms]
(pass) Context Builder > throws error when symbol lookup fails
(pass) Context Builder > handles ripgrep error in symbol lookup [0.10ms]

src/features/context/cli.test.ts:
(pass) context CLI > outputs context for a file [203.64ms]
(pass) context CLI > includes MCP resources when requested [138.72ms]

src/features/memory/summarize.test.ts:
(pass) summarizeMemory > handles empty/missing directories gracefully [1.13ms]
(pass) summarizeMemory > filters entries by confidence and source [1.65ms]
(pass) summarizeMemory > sorts by timestamp and prioritizes recent [1.04ms]
(pass) summarizeMemory > deduplicates durable and daily [0.93ms]

src/features/memory/engine.test.ts:
(pass) MemoryEngine > addEntry creates daily file and stores embedding [0.97ms]
(pass) MemoryEngine > deleteEntry removes record from file [1.12ms]
(pass) MemoryEngine > updateEntry modifies existing record [1.23ms]
(pass) MemoryEngine > search semantic works [0.75ms]
{"level":"warn","event":"memory.embedding_failed","timestamp":1770093571231,"metadata":{"error":"Embed provider returned no embedding"}}
(pass) MemoryEngine > clearAll removes files [1.02ms]
(pass) MemoryEngine > promoteEntry moves to durable [0.81ms]
{"level":"warn","event":"memory.embedding_failed","timestamp":1770093571233,"metadata":{"error":"Embed provider returned no embedding"}}
{"level":"warn","event":"memory.embedding_failed","timestamp":1770093571251,"metadata":{"error":"Embed provider returned no embedding"}}
(pass) MemoryEngine > import/export [19.84ms]
(pass) MemoryEngine > importData throws on invalid format [0.60ms]

src/features/identity/init.test.ts:
(pass) Identity Initialization > initIdentity creates necessary files [1.39ms]
(pass) Identity Initialization > initIdentity does not overwrite existing files by default [0.71ms]

src/features/embed/engine.test.ts:
(pass) embed engine > selects mock provider
(pass) embed engine > returns deterministic embedding from mock [0.12ms]

src/features/embed/cli.test.ts:
(pass) nooa embed cli direct > shows help via execute [0.94ms]
(pass) nooa embed cli direct > embeds text success via execute [0.29ms]
(pass) nooa embed cli direct > embeds file success via execute [0.47ms]
(pass) nooa embed cli direct > fails on missing action via execute [0.33ms]
(pass) nooa embed cli direct > fails on missing text via execute [0.16ms]
(pass) nooa embed cli direct > fails on missing file path via execute [0.19ms]
(pass) nooa embed cli direct > fails on unknown action via execute [0.19ms]
(pass) nooa embed cli direct > respects --include-embedding flag via execute [0.22ms]
(pass) nooa embed cli direct > respects --out flag via execute [0.67ms]
(pass) nooa embed cli direct > handles general errors gracefully in execute [0.52ms]

src/features/chat/execute.test.ts:
(pass) executeMessage > returns message object with timestamp [1.23ms]
(pass) executeMessage > handles different roles [1.02ms]
(pass) executeMessage > formatOutput formats as JSON [0.07ms]
(pass) executeMessage > formatOutput formats as text

src/features/chat/cli.test.ts:
(pass) nooa message > shows help [92.83ms]
(pass) nooa message > validation > requires message text [93.95ms]
(pass) nooa message > validation > validates role values [96.41ms]
(pass) nooa message > validation > accepts valid roles [273.99ms]
(pass) nooa message > integration > outputs plain text by default [97.24ms]
(pass) nooa message > integration > outputs JSON when --json flag is used [93.12ms]
(pass) nooa message > integration > respects role flag [97.07ms]

src/features/ignore/cli.test.ts:
(pass) nooa ignore > shows help with check and test [90.45ms]
(pass) nooa ignore > prints ignored result when path matches [94.95ms]
(pass) nooa ignore > prints not ignored result when path does not match [100.04ms]
(pass) nooa ignore > tests a new pattern against provided paths [97.46ms]
(pass) nooa ignore > fails when test pattern matches nothing [96.79ms]

src/features/ci/execute.test.ts:
(pass) executeCi > should return structured result with ok and traceId [161.25ms]

src/features/ci/cli.test.ts:
(pass) ci CLI > should show help [91.91ms]
(pass) ci CLI > should output JSON with correct schema [88.78ms]

src/features/doctor/execute.test.ts:
(pass) executeDoctorCheck > should check all required tools and return result [29.27ms]

src/features/doctor/cli.test.ts:
(pass) doctor CLI > should show help [84.99ms]
(pass) doctor CLI > should output JSON with correct schema [123.11ms]

src/features/read/cmd.test.ts:
(pass) Read Command Definition > exports valid command [0.58ms]
hello-read{"level":"info","event":"read.success","timestamp":1770093573230,"metadata":{"path":"telemetry-read.txt","bytes":10,"duration_ms":0}}
(pass) Read Command Definition > records telemetry on successful read [7.77ms]

src/features/read/execute.test.ts:
(pass) read command > help: displays help [0.50ms]
{"level":"warn","event":"read.missing_path","timestamp":1770093573239,"metadata":{"duration_ms":1}}
(pass) read command > failure: missing path and TTY [1.06ms]
{"level":"info","event":"read.success","timestamp":1770093573240,"metadata":{"path":"/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/fix-tests-100/src/features/read/tmp-test-read/stdin_path.txt","bytes":13,"duration_ms":0}}
(pass) read command > success: read path from stdin [0.90ms]
{"level":"info","event":"read.success","timestamp":1770093573240,"metadata":{"path":"/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/fix-tests-100/src/features/read/tmp-test-read/test.json","bytes":12,"duration_ms":0}}
(pass) read command > success: json output [0.78ms]
{"level":"error","event":"read.failure","timestamp":1770093573241,"metadata":{"path":"nonexistent.txt","duration_ms":0,"error_message":"ENOENT: no such file or directory, open 'nonexistent.txt'"}}
(pass) read command > error handling: file not found [0.63ms]
{"level":"error","event":"read.failure","timestamp":1770093573242,"metadata":{"path":"/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/fix-tests-100/src/features/read/tmp-test-read","duration_ms":0,"error_message":"EISDIR: illegal operation on a directory, read"}}
(pass) read command > error handling: other error [0.79ms]

src/features/worktree/execute.test.ts:
(pass) worktree output > writes summary to stderr and keeps stdout empty [238.74ms]

src/features/worktree/cli.test.ts:
(pass) nooa worktree > shows help [87.60ms]
(pass) nooa worktree > creates a worktree under .worktrees/<branch> [239.39ms]
(pass) nooa worktree > respects --no-install and --no-test [239.59ms]
(pass) nooa worktree > installs deps and runs tests by default [262.27ms]
(pass) nooa worktree > lists worktrees with list subcommand [497.11ms]
(pass) nooa worktree > reports worktree info from info subcommand [343.31ms]
(pass) nooa worktree > removes worktree using remove subcommand [353.60ms]
(pass) nooa worktree > prunes worktrees via prune subcommand [171.02ms]
(pass) nooa worktree > locks and unlocks worktrees [468.56ms]

src/features/code/cli-patch.test.ts:
(pass) nooa code write --patch > --help includes patch flags [89.82ms]
(pass) nooa code write --patch > applies patch from stdin [94.04ms]

src/features/code/write.test.ts:
(pass) writeCodeFile > writes content when file does not exist [0.97ms]
(pass) writeCodeFile > fails when file exists without overwrite [0.26ms]
(pass) writeCodeFile > overwrites when overwrite is true [0.28ms]
(pass) writeCodeFile > dry-run does not write file [0.20ms]

src/features/code/refactor.test.ts:
(pass) Code Refactor Feature > executeRefactor reads, prompts AI, and writes back [0.77ms]

src/features/code/cmd.test.ts:
(pass) Code Command Definition > exports valid command [0.33ms]

src/features/code/format.test.ts:
(pass) Code Format Feature > executeFormat runs biome wrapper [0.17ms]

src/features/code/cli-write.test.ts:
(pass) nooa code write > nooa code write --help shows usage [96.32ms]
(pass) nooa code write > writes from --from file [96.57ms]
(pass) nooa code write > fails if file exists without --overwrite [94.40ms]
(pass) nooa code write > supports --overwrite [93.32ms]
(pass) nooa code write > writes from stdin [95.51ms]
(pass) nooa code write > dry-run reports without writing [96.30ms]

src/features/code/patch.test.ts:
(pass) applyPatch > applies unified diff [0.49ms]

src/features/code/diff.test.ts:
(pass) Code Diff Feature > executeDiff returns diff output
(pass) Code Diff Feature > executeDiff passes arguments to git diff

src/features/code/execute.test.ts:
{"level":"warn","event":"code.write.missing_path","timestamp":1770093576980,"metadata":{"duration_ms":0}}
(pass) code command execute > write: failure - missing path [1.65ms]
{"level":"info","event":"code.write.success","timestamp":1770093576982,"metadata":{"path":"/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/fix-tests-100/src/features/code/tmp-test-code/test.txt","bytes":11,"overwritten":false,"dry_run":false,"duration_ms":0}}
(pass) code command execute > write: success - basic write [1.35ms]
{"level":"warn","event":"code.write.missing_input","timestamp":1770093577185,"metadata":{"duration_ms":203}}
(pass) code command execute > write: failure - missing input [202.92ms]
{"level":"info","event":"code.write.success","timestamp":1770093577186,"metadata":{"path":"/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/fix-tests-100/src/features/code/tmp-test-code/dry.txt","bytes":9,"overwritten":false,"dry_run":true,"duration_ms":0}}
(pass) code command execute > write: dry-run [1.16ms]
{"level":"info","event":"code.write.success","timestamp":1770093577187,"metadata":{"path":"/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/fix-tests-100/src/features/code/tmp-test-code/test.json","bytes":12,"overwritten":false,"dry_run":false,"duration_ms":0}}
(pass) code command execute > write: json output [0.74ms]
{"level":"info","event":"code.patch.success","timestamp":1770093577188,"metadata":{"path":"/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/fix-tests-100/src/features/code/tmp-test-code/to_patch.txt","bytes":16,"dry_run":false,"duration_ms":0}}
(pass) code command execute > patch: basic success [1.05ms]
{"level":"info","event":"code.patch.success","timestamp":1770093577188,"metadata":{"path":"/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/fix-tests-100/src/features/code/tmp-test-code/to_patch_sub.txt","bytes":11,"dry_run":false,"duration_ms":0}}
(pass) code command execute > patch subcommand: implies patch mode [0.77ms]
(pass) code command execute > help: displays help and returns [0.34ms]
{"level":"warn","event":"code.patch.invalid_flags","timestamp":1770093577189,"metadata":{"duration_ms":0}}
(pass) code command execute > error handling: patch exclusive with from [0.45ms]
{"level":"warn","event":"code.patch.missing_input","timestamp":1770093577391,"metadata":{"duration_ms":202}}
(pass) code command execute > patch: missing input error [202.11ms]
{"level":"info","event":"code.patch.success","timestamp":1770093577392,"metadata":{"path":"/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/fix-tests-100/src/features/code/tmp-test-code/to_patch_json.txt","bytes":9,"dry_run":false,"duration_ms":0}}
(pass) code command execute > patch: json output [1.22ms]
{"level":"info","event":"code.write.success","timestamp":1770093577393,"metadata":{"path":"/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/fix-tests-100/src/features/code/tmp-test-code/stdin_out.txt","bytes":13,"overwritten":false,"dry_run":false,"duration_ms":0}}
(pass) code command execute > write: from stdin [0.98ms]
{"level":"error","event":"code.write.failure","timestamp":1770093577395,"metadata":{"duration_ms":0,"error_message":"File already exists: /Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/fix-tests-100/src/features/code/tmp-test-code","error_stack":"Error: File already exists: /Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/fix-tests-100/src/features/code/tmp-test-code\n    at writeCodeFile (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/fix-tests-100/src/features/code/write.ts:30:13)\n    at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/fix-tests-100/src/features/code/cli.ts:231:27)\n    at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/fix-tests-100/src/features/code/execute.test.ts:324:21)\n    at processTicksAndRejections (native:7:39)"}}
(pass) code command execute > error handling: unexpected error [1.20ms]
(pass) code command execute > unknown action: displays help [0.33ms]

src/features/mcp/configure.test.ts:
(pass) configure merges env from --env-file [4.31ms]
(pass) configure picks up .mcp.env when present [2.27ms]
(pass) configure honors global -> root -> explicit env files [2.70ms]

src/features/mcp/init.test.ts:
(pass) nooa mcp init installs recommended MCPs [2.92ms]
(pass) nooa mcp init respects --skip-github [1.31ms]
(pass) nooa mcp init --github-token configures GitHub env [1.68ms]
(pass) interactive wizard prompts for GitHub token [2.18ms]
(pass) nooa mcp init shows help [0.07ms]
(pass) nooa mcp init skips existing if not forced [1.46ms]
(pass) interactive 'no' skips installation [0.85ms]
(pass) force reinstall removes existing [2.45ms]
(pass) init honors env var NOOA_NON_INTERACTIVE [1.36ms]
(pass) prompt handles defaults for empty inputs [1.37ms]
(pass) nooa mcp init emits JSON [0.52ms]
(pass) init handles errors gracefully [2.01ms]

src/features/mcp/install.test.ts:
(pass) nooa mcp install registers an MCP [1.80ms]
(pass) nooa mcp info prints saved MCP metadata [1.72ms]
(pass) nooa mcp configure updates settings [1.58ms]

src/features/mcp/subcommands.test.ts:
(pass) list command shows help [0.42ms]
(pass) install command shows help
(pass) install command requires package name
(pass) enable command shows help [0.37ms]
(pass) enable command requires MCP name
(pass) disable command shows help
(pass) disable command requires MCP name

src/features/mcp/uninstall.test.ts:
(pass) nooa mcp uninstall removes an entry [2.65ms]

src/features/mcp/alias.test.ts:
(pass) alias create/list/delete flow [3.33ms]
(pass) list shows json output when --json [1.11ms]

src/features/mcp/test.test.ts:
(pass) nooa mcp test checks server health [24.09ms]

src/features/mcp/marketplace.test.ts:
(pass) marketing command prints results [0.30ms]
(pass) marketplace supports verified-only filter
(pass) marketplace emits JSON output

src/features/mcp/enable-disable.test.ts:
(pass) nooa mcp enable toggles a disabled MCP [1.99ms]
(pass) nooa mcp disable turns off an enabled MCP [1.48ms]

src/features/mcp/call.test.ts:
(pass) nooa mcp call executes an MCP tool [24.97ms]
(pass) nooa mcp call accepts retry/backoff flags [24.75ms]

src/features/mcp/resource.test.ts:
(pass) nooa mcp resource reads a resource URI [23.99ms]

src/features/mcp/cli.test.ts:
(pass) MCP CLI Dispatcher > shows help with no args [0.09ms]
(pass) MCP CLI Dispatcher > shows help with --help
(pass) MCP CLI Dispatcher > handles unknown subcommand
(pass) MCP CLI Dispatcher > dispatches init
(pass) MCP CLI Dispatcher > dispatches alias
(pass) MCP CLI Dispatcher > dispatches list
(pass) MCP CLI Dispatcher > dispatches install
(pass) MCP CLI Dispatcher > dispatches enable
(pass) MCP CLI Dispatcher > dispatches disable
(pass) MCP CLI Dispatcher > dispatches call
(pass) MCP CLI Dispatcher > dispatches resource
(pass) MCP CLI Dispatcher > dispatches health
(pass) MCP CLI Dispatcher > dispatches marketplace
(pass) MCP CLI Dispatcher > dispatches info [0.46ms]
(pass) MCP CLI Dispatcher > dispatches configure
(pass) MCP CLI Dispatcher > dispatches uninstall [0.02ms]
(pass) MCP CLI Dispatcher > dispatches test

src/features/mcp/list.test.ts:
35 | 		await seedMockServer(dbPath, { name: "mock-two", enabled: false });
36 | 
37 | 		const { exitCode, output } = await captureJsonLog(() =>
38 | 			listCommand(["--installed", "--json"]),
39 | 		);
40 | 		expect(exitCode).toBe(0);
                        ^
error: expect(received).toBe(expected)

Expected: 0
Received: 42

      at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/fix-tests-100/src/features/mcp/list.test.ts:40:20)
      at async withDbPath (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/fix-tests-100/src/features/mcp/list.test.ts:25:9)
      at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/fix-tests-100/src/features/mcp/list.test.ts:33:8)
(fail) nooa mcp list --installed includes every MCP [1.95ms]
54 | 		await seedMockServer(dbPath, { name: "mock-disabled", enabled: false });
55 | 
56 | 		const { exitCode, output } = await captureJsonLog(() =>
57 | 			listCommand(["--enabled", "--json"]),
58 | 		);
59 | 		expect(exitCode).toBe(0);
                        ^
error: expect(received).toBe(expected)

Expected: 0
Received: 42

      at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/fix-tests-100/src/features/mcp/list.test.ts:59:20)
      at async withDbPath (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/fix-tests-100/src/features/mcp/list.test.ts:25:9)
      at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/fix-tests-100/src/features/mcp/list.test.ts:52:8)
(fail) nooa mcp list --enabled shows enabled MCPs only [2.00ms]

src/features/mcp/health.test.ts:
32 | 	}
33 | }
34 | 
35 | test("nooa mcp health prints error when name missing", async () => {
36 | 	const { exitCode, stderr } = await captureOutput(() => healthCommand([]));
37 | 	expect(exitCode).toBe(2);
                       ^
error: expect(received).toBe(expected)

Expected: 2
Received: 42

      at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/fix-tests-100/src/features/mcp/health.test.ts:37:19)
(fail) nooa mcp health prints error when name missing [0.08ms]
42 | 	await withMcpDb(async (dbPath) => {
43 | 		await seedMockServer(dbPath);
44 | 		const { exitCode, stdout } = await captureOutput(() =>
45 | 			healthCommand(["mock"]),
46 | 		);
47 | 		expect(exitCode).toBe(0);
                        ^
error: expect(received).toBe(expected)

Expected: 0
Received: 42

      at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/fix-tests-100/src/features/mcp/health.test.ts:47:20)
      at async withMcpDb (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/fix-tests-100/src/features/mcp/health.test.ts:28:9)
      at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/fix-tests-100/src/features/mcp/health.test.ts:42:8)
(fail) nooa mcp health returns healthy status text [1.33ms]
54 | 	await withMcpDb(async (dbPath) => {
55 | 		await seedMockServer(dbPath);
56 | 		const { exitCode, stdout } = await captureOutput(() =>
57 | 			healthCommand(["mock", "--json"]),
58 | 		);
59 | 		expect(exitCode).toBe(0);
                        ^
error: expect(received).toBe(expected)

Expected: 0
Received: 42

      at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/fix-tests-100/src/features/mcp/health.test.ts:59:20)
      at async withMcpDb (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/fix-tests-100/src/features/mcp/health.test.ts:28:9)
      at async <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/fix-tests-100/src/features/mcp/health.test.ts:54:8)
(fail) nooa mcp health --json returns structured status [1.02ms]

src/features/search/engine.test.ts:
(pass) Search Engine > native search finds exact matches [1.11ms]
(pass) Search Engine > native search respects include patterns [0.75ms]
(pass) Search Engine > native search respects exclude patterns [0.64ms]
(pass) Search Engine > native search supports regex [0.72ms]
(pass) Search Engine > native search supports context [0.79ms]
(pass) Search Engine > native search supports count mode [0.72ms]
(pass) Search Engine > native search handles large files (skip) [0.48ms]
(pass) Search Engine > native search ignores binary files [1.66ms]
(pass) Search Engine > rg search parses JSON output [1.11ms]
(pass) Search Engine > rg search handles context [0.99ms]

src/features/search/cli.test.ts:
(pass) nooa search > shows help [89.96ms]
(pass) nooa search > outputs JSON format [89.51ms]
(pass) nooa search > outputs plain format [90.51ms]
(pass) nooa search > lists files only [91.14ms]
(pass) nooa search > records telemetry [95.72ms]

src/features/pr/gh.test.ts:
(pass) GitHub Automation (gh.ts) > ghPrCreate success [0.20ms]
(pass) GitHub Automation (gh.ts) > ghPrCreate failure
(pass) GitHub Automation (gh.ts) > ghPrList [0.07ms]
(pass) GitHub Automation (gh.ts) > ghPrDiff [0.06ms]
(pass) GitHub Automation (gh.ts) > ghMergePr (squash) [0.09ms]
(pass) GitHub Automation (gh.ts) > ghMergePr (rebase)
(pass) GitHub Automation (gh.ts) > ghMergePr (merge)
(pass) GitHub Automation (gh.ts) > ghClosePr [0.09ms]
(pass) GitHub Automation (gh.ts) > ghCommentPr [0.01ms]
(pass) GitHub Automation (gh.ts) > ghStatusPr

src/features/pr/cli.test.ts:
(pass) nooa pr > pr --help shows usage [88.61ms]
(pass) nooa pr > merge requires pr number [83.80ms]
(pass) nooa pr > close requires pr number [86.65ms]
(pass) nooa pr > comment requires pr number [86.51ms]
(pass) nooa pr > status requires pr number [88.09ms]
(pass) nooa pr > merge uses gh and validates pr number [86.24ms]
(pass) nooa pr > status uses gh and validates pr number [89.25ms]

src/features/push/cli.test.ts:
(pass) nooa push > shows help [83.21ms]
(pass) nooa push > fails when working tree is dirty [137.10ms]
(pass) nooa push > pushes to remote [249.69ms]

src/features/guardrail/schemas.test.ts:
(pass) Guardrail Schemas > PatternSchema > should validate a literal pattern [0.40ms]
(pass) Guardrail Schemas > PatternSchema > should validate a regex pattern
(pass) Guardrail Schemas > PatternSchema > should default type to literal [0.06ms]
(pass) Guardrail Schemas > PatternSchema > should reject invalid type [0.07ms]
(pass) Guardrail Schemas > PatternSpecSchema > should validate anyOf patterns [0.26ms]
(pass) Guardrail Schemas > PatternSpecSchema > should validate allOf patterns
(pass) Guardrail Schemas > PatternSpecSchema > should accept empty spec
(pass) Guardrail Schemas > RefactorRuleSchema > should validate a complete rule [0.30ms]
(pass) Guardrail Schemas > RefactorRuleSchema > should reject rule without id
(pass) Guardrail Schemas > RefactorRuleSchema > should default severity to medium [0.11ms]
(pass) Guardrail Schemas > RefactorProfileSchema > should validate a complete profile [0.22ms]
(pass) Guardrail Schemas > RefactorProfileSchema > should reject profile without name
(pass) Guardrail Schemas > RefactorProfileSchema > should reject profile without rules

src/features/guardrail/engine.test.ts:
(pass) GuardrailEngine > evaluate > should find TODO patterns in files [21.87ms]
(pass) GuardrailEngine > evaluate > should respect scope.exclude patterns [19.52ms]
(pass) GuardrailEngine > evaluate > should return findings with correct structure [17.64ms]
(pass) GuardrailEngine > evaluate > requires all patterns in allOf within same file [25.40ms]
fatal: not a git repository (or any of the parent directories): .git
(pass) GuardrailEngine > evaluate > falls back to scanning files when not a git repo [16.52ms]
(pass) GuardrailEngine > determinism > should produce identical findings on repeated runs [55.00ms]
(pass) GuardrailEngine > determinism > should return findings sorted by rule, file, line [27.40ms]

src/features/guardrail/builtin-rules.test.ts:
(pass) Built-in Profiles > Profile Loading > should load zero-preguica profile [8.20ms]
(pass) Built-in Profiles > Profile Loading > should load security profile [5.14ms]
(pass) Built-in Profiles > Profile Loading > should load dangerous-patterns profile [1.68ms]
(pass) Built-in Profiles > Zero-Preguiça Detection > should detect TODO violations [50.75ms]
(pass) Built-in Profiles > Zero-Preguiça Detection > should detect FIXME violations [50.18ms]
(pass) Built-in Profiles > Security Detection > should detect hardcoded secrets [374.19ms]
(pass) Built-in Profiles > Security Detection > should detect eval usage [368.95ms]

src/features/guardrail/builtin.test.ts:
(pass) getBuiltinProfilesDir returns correct path [0.55ms]
(pass) listBuiltinProfiles returns known profiles [0.03ms]
(pass) loadBuiltinProfile loads a profile [2.03ms]

src/features/guardrail/profiles.test.ts:
(pass) Profile Loader > loadProfile > should load a valid NOOA-style profile [0.59ms]
(pass) Profile Loader > loadProfile > should throw on invalid YAML [0.44ms]
(pass) Profile Loader > loadProfile > should throw on non-existent file [0.06ms]
(pass) Profile Loader > validateProfile > should return valid: true for valid profile [0.50ms]
(pass) Profile Loader > validateProfile > should return valid: false with errors for invalid profile [0.36ms]
(pass) Profile Loader > normalizeToNooaFormat (Auditor compatibility) > should normalize Auditor-style identifiers to NOOA patterns [0.04ms]
(pass) Profile Loader > normalizeToNooaFormat (Auditor compatibility) > should pass through NOOA-style patterns unchanged [0.01ms]
(pass) Profile Loader > normalizeToNooaFormat (Auditor compatibility) > should return empty spec for empty input

src/features/guardrail/anarchy-regression.test.ts:
(pass) Anarchy Baseline Profile > should load anarchy-baseline profile successfully [1.15ms]
(pass) Anarchy Baseline Profile > should validate anarchy-baseline profile schema [0.78ms]
(pass) Anarchy Baseline Profile > should have secret detection rules [0.84ms]
(pass) Anarchy Baseline Profile > should have dependency risk rules [1.02ms]
(pass) Anarchy Baseline Profile > should have test quality rules [0.87ms]

src/features/guardrail/cli.test.ts:
(pass) Guardrail CLI > check fails without profile or spec [33.75ms]
(pass) Guardrail CLI > root help [35.39ms]
(pass) Guardrail CLI > check with spec loads spec file [47.38ms]
(pass) Guardrail CLI > init creates default profile [33.26ms]
✅ Initialized .nooa/guardrails/ directory
   Created: profiles/default.yaml

Run: nooa guardrail check --profile .nooa/guardrails/profiles/default.yaml
(pass) Guardrail CLI > validate passes for valid profile [36.03ms]
(pass) Guardrail CLI > validate fails for missing profile [33.23ms]
(pass) Guardrail CLI > validate fails for invalid profile content [33.78ms]
✅ Initialized .nooa/guardrails/ directory
   Created: profiles/default.yaml

Run: nooa guardrail check --profile .nooa/guardrails/profiles/default.yaml
(pass) Guardrail CLI > check runs guardrail checks [62.62ms]
(pass) Guardrail CLI > spec init creates GUARDRAIL.md [35.11ms]
(pass) Guardrail CLI > spec validate checks profiles [35.21ms]
(pass) Guardrail CLI > unknown subcommand shows help [33.94ms]
(pass) Guardrail CLI > add creates new profile [32.81ms]
(pass) Guardrail CLI > add fails if profile exists [34.94ms]
(pass) Guardrail CLI > list displays available profiles [34.99ms]
(pass) Guardrail CLI > show displays profile content [35.92ms]
(pass) Guardrail CLI > remove deletes profile [34.60ms]
(pass) Guardrail CLI > spec show lists enabled profiles [34.20ms]

src/features/guardrail/contracts.test.ts:
(pass) Guardrail Contracts > Severity > should have correct severity levels
(pass) Guardrail Contracts > Severity > should have 5 severity levels [0.06ms]
(pass) Guardrail Contracts > Confidence > should have correct confidence levels [0.01ms]
(pass) Guardrail Contracts > Confidence > should have 3 confidence levels
(pass) Guardrail Contracts > Finding interface > should accept a valid finding
(pass) Guardrail Contracts > Finding interface > should accept optional trace field
(pass) Guardrail Contracts > GuardrailReport interface > should accept a valid report
(pass) Guardrail Contracts > GuardrailReport interface > should have correct status values [0.03ms]

src/features/guardrail/spec.test.ts:
(pass) Spec Parser > parseGuardrailSpec > should return defaults when no spec file exists [0.02ms]
(pass) Spec Parser > parseGuardrailSpec > should parse profiles from spec [0.23ms]
(pass) Spec Parser > parseGuardrailSpec > should parse thresholds from spec [0.14ms]
(pass) Spec Parser > parseGuardrailSpec > should parse custom rules from spec [0.30ms]
(pass) Spec Parser > parseGuardrailSpec > should parse exclusions from spec [0.55ms]
(pass) Spec Parser > parseGuardrailSpec > parses custom rules without require() [0.36ms]
(pass) Spec Parser > parseGuardrailSpec > does not rely on require() for yaml parsing [0.08ms]
(pass) Spec Parser > buildProfileFromSpec > should build combined profile from spec [0.10ms]

src/features/prompt/service.test.ts:
(pass) Prompt Service > createPrompt > creates new prompt file [1.83ms]
(pass) Prompt Service > createPrompt > fails if prompt already exists [0.58ms]
(pass) Prompt Service > createPrompt > rethrows non-ENOENT errors during check [0.24ms]
(pass) Prompt Service > deletePrompt > deletes existing prompt [0.67ms]
(pass) Prompt Service > deletePrompt > throws if prompt not found [0.31ms]
(pass) Prompt Service > editPrompt > applies patch to prompt [0.67ms]
(pass) Prompt Service > publishPrompt > bumps version and creates changelog [1.22ms]
(pass) Prompt Service > publishPrompt > updates existing changelog with new section [1.06ms]
(pass) Prompt Service > publishPrompt > updates existing section in changelog [0.99ms]

src/features/prompt/engine.test.ts:
(pass) PromptEngine > listPrompts returns valid prompts [1.03ms]
(pass) PromptEngine > listPrompts handles errors gracefully [0.43ms]
(pass) PromptEngine > loadPrompt parses correctly [0.31ms]
(pass) PromptEngine > parsePrompt throws on missing frontmatter [0.13ms]
(pass) PromptEngine > parsePrompt throws on invalid metadata [0.13ms]
(pass) PromptEngine > renderPrompt substitutes variables [0.16ms]
(pass) PromptEngine > renderPrompt includes agent context [0.17ms]
(pass) PromptEngine > renderPrompt includes injected context [0.14ms]
(pass) PromptEngine > bumpVersion increments version correctly [0.65ms]
(pass) PromptEngine > bumpVersion throws on invalid version [0.40ms]

src/features/prompt/cli.test.ts:
(pass) nooa prompt --help lists new subcommands [92.09ms]
(pass) nooa prompt create writes a new prompt [95.49ms]
(pass) nooa prompt edit applies patch from stdin [99.51ms]
(pass) nooa prompt delete removes prompt file [95.85ms]
(pass) nooa prompt publish bumps version and updates changelog [99.66ms]

src/features/ai/engine.test.ts:
(pass) AiEngine > complete() > registers and uses a provider [0.13ms]
(pass) AiEngine > complete() > throws error for missing provider
{"level":"warn","event":"AI request failed (attempt 1/4), retrying in 115ms","timestamp":1770093581541,"metadata":{"error":"Transient failure"}}
{"level":"warn","event":"AI request failed (attempt 2/4), retrying in 167ms","timestamp":1770093581656,"metadata":{"error":"Transient failure"}}
(pass) AiEngine > complete() > retries on failure [282.56ms]
{"level":"warn","event":"Primary provider primary completed failed, falling back to secondary","timestamp":1770093581823,"metadata":{"error":"Transient failure"}}
(pass) AiEngine > complete() > falls back to secondary provider [0.30ms]
{"level":"warn","event":"Primary provider primary completed failed, falling back to secondary","timestamp":1770093581824,"metadata":{"error":"Transient failure"}}
(pass) AiEngine > complete() > rethrows error if fallback fails [0.03ms]
(pass) AiEngine > embed() > uses provider for embedding [0.24ms]
(pass) AiEngine > embed() > throws error for missing provider in embed [0.04ms]
{"level":"warn","event":"AI request failed (attempt 1/3), retrying in 183ms","timestamp":1770093581824,"metadata":{"error":"Embed failure"}}
(pass) AiEngine > embed() > retries on embed failure [183.92ms]
{"level":"warn","event":"Primary provider p1 embed failed, falling back to p2","timestamp":1770093582008,"metadata":{"error":"Embed failure"}}
(pass) AiEngine > embed() > falls back in embed [0.25ms]

src/features/ai/cli.test.ts:
(pass) nooa ai can invoke an MCP tool [95.05ms]

src/features/review/discovery.test.ts:
(pass) Test Discovery heuristic > finds test in same directory [64.46ms]
(pass) Test Discovery heuristic > finds test in root tests/ directory [63.86ms]
(pass) Test Discovery heuristic > returns empty array if no test found [63.03ms]

src/features/review/execute.test.ts:
(pass) executeReview > normalizes 'maintainability' category to 'arch' [13.89ms]
(pass) executeReview > defaults null file to input_path [13.24ms]

src/features/fix/execute.test.ts:
(pass) executeFix > should track telemetry and return ok in dry run [1.16ms]
(pass) executeFix > should carry out full fix loop (Stage 1-5) [0.84ms]
(pass) executeFix > should handle failures in stages [0.11ms]
(pass) executeFix > should handle error when goal or search fails [20.84ms]

src/features/fix/cli.test.ts:
(pass) fix CLI > should show help [89.62ms]
(pass) fix CLI > should output JSON [88.72ms]

src/features/index/index.test.ts:
(pass) Index Feature Execution > clearIndex calls store.clear [0.08ms]
(pass) Index Feature Execution > getIndexStats calls store.stats [0.12ms]
(pass) Index Feature Execution > indexRepo recursively lists and indexes files [0.46ms]
(pass) Index Feature Execution > executeSearch embeds query and searches store [0.06ms]
(pass) Index Feature Execution > rebuildIndex calls clear and indexRepo [0.06ms]
(pass) Index Feature Execution > chunking logic with large text

src/features/skills/manager.test.ts:
(pass) SkillManager > createSkill creates directory and main file [0.99ms]
(pass) SkillManager > listSkills returns all skills [1.30ms]
(pass) SkillManager > deleteSkill removes directory [0.38ms]
(pass) SkillManager > enable/disable skill [0.49ms]
(pass) SkillManager > updateSkill verifies existence [0.36ms]
(pass) SkillManager > showSkill handles frontmatter correctly [0.49ms]
(pass) SkillManager > parseFrontmatter edge cases [0.21ms]
(pass) SkillManager > listSkills handles empty root [0.30ms]

src/features/skills/cli.test.ts:
Current skills:
  - s1 (enabled): d1
(pass) Skills CLI > list subcommand [0.36ms]
Current skills:
  (none)
(pass) Skills CLI > list subcommand empty
Skill 'new-skill' created.
(pass) Skills CLI > add subcommand
Error: Skill name required.
(pass) Skills CLI > add subcommand error on missing name [0.16ms]
Skill 'old-skill' removed.
(pass) Skills CLI > remove subcommand [0.07ms]
Error: Skill name required.
(pass) Skills CLI > remove subcommand error on missing name [0.02ms]
Skill 's1' enabled.
(pass) Skills CLI > enable subcommand [0.03ms]
Error: Skill name required.
(pass) Skills CLI > enable subcommand error on missing name [0.03ms]
Skill 's1' disabled.
(pass) Skills CLI > disable subcommand
Error: Skill name required.
(pass) Skills CLI > disable subcommand error on missing name
Name: test
Description: desc

Content:

content
(pass) Skills CLI > show subcommand
Error: Skill name required.
(pass) Skills CLI > show subcommand error on missing name
Skill 's1' updated successfully.
(pass) Skills CLI > update subcommand [0.19ms]
Error: Skill name required.
(pass) Skills CLI > update subcommand error on missing name
(pass) Skills CLI > help output

src/features/eval/cli.test.ts:
(pass) nooa eval CLI extensions > help lists report/history/compare [90.45ms]
(pass) nooa eval CLI extensions > history prints matching entries [91.29ms]
(pass) nooa eval CLI extensions > report returns the latest entry [89.88ms]
(pass) nooa eval CLI extensions > compare shows score delta between entries [86.62ms]

src/features/run/parser.test.ts:
(pass) pipeline parser > delimiter mode > splits by -- [0.62ms]
(pass) pipeline parser > delimiter mode > unescapes \-- in delimiter mode [0.03ms]
(pass) pipeline parser > delimiter mode > handles internal vs external
(pass) pipeline parser > string mode > parses quoted strings [0.32ms]
(pass) pipeline parser > string mode > unescapes \-- in string mode [0.03ms]
(pass) pipeline parser > string mode > detects exec prefix [0.02ms]

src/features/goal/execute.test.ts:
(pass) Goal Manager > can set and get goal [0.78ms]
(pass) Goal Manager > returns null if no goal exists [0.15ms]
(pass) Goal Manager > can clear a goal [0.47ms]
(pass) Goal Manager > clearGoal does nothing if file doesn't exist [0.15ms]

src/features/goal/cli.test.ts:
(pass) Goal CLI > goal --help shows usage [89.97ms]
(pass) Goal CLI > goal status --json outputs structured data [90.31ms]

src/features/cron/cli.test.ts:
(pass) nooa cron CLI > shows help output [95.72ms]
(pass) nooa cron CLI > add and lists jobs [186.70ms]
(pass) nooa cron CLI > list --json returns structured data [183.97ms]
(pass) nooa cron CLI > status, run, logs, and history work end-to-end [450.23ms]
(pass) nooa cron CLI > edit and remove commands enforce force and updates [445.08ms]

tests/features/alias/cli.test.ts:
30 | 		const env = { ...process.env, NOOA_DB_PATH: dbPath };
31 | 		const { stdout, exitCode } = await execa("bun", ["index.ts", "deploy"], {
32 | 			env,
33 | 			reject: false,
34 | 		});
35 | 		expect(exitCode).toBe(0);
                        ^
error: expect(received).toBe(expected)

Expected: 0
Received: 1

      at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/fix-tests-100/tests/features/alias/cli.test.ts:35:20)
(fail) alias dispatches stored command [86.03ms]
57 | 			"bun",
58 | 			["index.ts", "json-list", "--json"],
59 | 			{ env, reject: false },
60 | 		);
61 | 
62 | 		expect(exitCode).toBe(0);
                        ^
error: expect(received).toBe(expected)

Expected: 0
Received: 1

      at <anonymous> (/Users/thiagobutignon/dev/nooa-the-pragmatic/.worktrees/fix-tests-100/tests/features/alias/cli.test.ts:62:20)
(fail) alias appends invocation arguments [83.29ms]

src/features/ai/providers/openai.test.ts:
(pass) OpenAiProvider > complete() sends correct request [0.25ms]
(pass) OpenAiProvider > complete() throws on missing API key [0.05ms]
(pass) OpenAiProvider > complete() throws on non-ok response
(pass) OpenAiProvider > complete() throws when no choices returned [0.08ms]
(pass) OpenAiProvider > embed() sends correct request [0.11ms]

src/features/ai/providers/ollama.test.ts:
(pass) OllamaProvider > complete() sends correct request [0.16ms]
(pass) OllamaProvider > complete() throws on error
(pass) OllamaProvider > embed() sends correct request [0.16ms]
(pass) OllamaProvider > embed() throws on error

src/features/eval/scorers/deterministic.test.ts:
(pass) DeterministicScorer > passes valid JSON check [0.21ms]
(pass) DeterministicScorer > extracts JSON from markdown [0.07ms]
(pass) DeterministicScorer > handles invalid JSON [0.10ms]
(pass) DeterministicScorer > skips checks if no valid JSON parsed [0.02ms]
(pass) DeterministicScorer > verifies properties [0.01ms]
(pass) DeterministicScorer > checks enums on arrays [0.09ms]
(pass) DeterministicScorer > fails on invalid enum value [0.03ms]
(pass) DeterministicScorer > detects absolute paths [0.04ms]
(pass) DeterministicScorer > verifies max_count
(pass) DeterministicScorer > verifies max_count success
(pass) DeterministicScorer > verifies property_equals
(pass) DeterministicScorer > handles missing property or limit for max_count [0.07ms]
(pass) DeterministicScorer > handles missing property for property_equals
(pass) DeterministicScorer > handles edge cases in getValues [0.06ms]
(pass) DeterministicScorer > handles general errors during check [0.02ms]

11 tests failed:
(fail) EventBus > publishes events to subscribers [5000.08ms]
  ^ this test timed out after 5000ms, before its done callback was called. If a done callback was not intended, remove the last parameter from the test callback function
(fail) EventBus > unsubscribes from events [5000.00ms]
  ^ this test timed out after 5000ms, before its done callback was called. If a done callback was not intended, remove the last parameter from the test callback function
(fail) EventBus > handles off with non-existent event [5000.05ms]
  ^ this test timed out after 5000ms, before its done callback was called. If a done callback was not intended, remove the last parameter from the test callback function
(fail) EventBus > handles emit with no subscribers [5000.00ms]
  ^ this test timed out after 5000ms, before its done callback was called. If a done callback was not intended, remove the last parameter from the test callback function
(fail) nooa mcp list --installed includes every MCP [1.95ms]
(fail) nooa mcp list --enabled shows enabled MCPs only [2.00ms]
(fail) nooa mcp health prints error when name missing [0.08ms]
(fail) nooa mcp health returns healthy status text [1.33ms]
(fail) nooa mcp health --json returns structured status [1.02ms]
(fail) alias dispatches stored command [86.03ms]
(fail) alias appends invocation arguments [83.29ms]
--------------------------------------------|---------|---------|-------------------
File                                        | % Funcs | % Lines | Uncovered Line #s
--------------------------------------------|---------|---------|-------------------
All files                                   |   95.71 |   96.06 |
 src/core/db/cron_store.ts                  |  100.00 |  100.00 | 
 src/core/db/index.ts                       |  100.00 |  100.00 | 
 src/core/db/schema/cron.ts                 |  100.00 |  100.00 | 
 src/core/db/schema/cron_jobs.ts            |  100.00 |   75.86 | 51-53,55-58
 src/core/db/schema/cron_logs.ts            |  100.00 |  100.00 | 
 src/core/db/schema/embeddings.ts           |  100.00 |  100.00 | 
 src/core/db/schema/mcp_aliases.ts          |  100.00 |  100.00 | 
 src/core/db/schema/mcp_servers.ts          |  100.00 |  100.00 | 
 src/core/event-bus.ts                      |   75.00 |  100.00 | 
 src/core/integrations/github.ts            |  100.00 |  100.00 | 
 src/core/io.ts                             |  100.00 |   96.72 | 79-80
 src/core/logger.ts                         |  100.00 |  100.00 | 
 src/core/mcp/Client.ts                     |   95.45 |   96.43 | 180-183
 src/core/mcp/ConfigStore.ts                |  100.00 |  100.00 | 
 src/core/mcp/Registry.ts                   |  100.00 |  100.00 | 
 src/core/mcp/ServerManager.ts              |   91.67 |  100.00 | 
 src/core/mcp/ToolProvider.ts               |  100.00 |  100.00 | 
 src/core/mcp/alias.ts                      |  100.00 |  100.00 | 
 src/core/mcp/db.ts                         |  100.00 |  100.00 | 
 src/core/memory/schema.ts                  |  100.00 |  100.00 | 
 src/core/policy/PolicyEngine.ts            |  100.00 |  100.00 | 
 src/core/reflection/hook.ts                |  100.00 |   93.55 | 20-21
 src/core/registry.ts                       |   85.71 |  100.00 | 
 src/core/skills/Discovery.ts               |  100.00 |  100.00 | 
 src/core/telemetry.ts                      |  100.00 |  100.00 | 
 src/features/ai/engine.ts                  |   92.31 |  100.00 | 
 src/features/ai/providers/mock.ts          |   85.71 |  100.00 | 
 src/features/ai/providers/mod.ts           |  100.00 |  100.00 | 
 src/features/ai/providers/ollama.ts        |   80.00 |  100.00 | 
 src/features/ai/providers/openai.ts        |   83.33 |  100.00 | 
 src/features/chat/execute.ts               |  100.00 |  100.00 | 
 src/features/ci/execute.ts                 |  100.00 |   86.60 | 29-36,47-51
 src/features/code/cli.ts                   |  100.00 |   91.56 | 78-82,86-95,99-109
 src/features/code/diff.ts                  |  100.00 |  100.00 | 
 src/features/code/format.ts                |  100.00 |  100.00 | 
 src/features/code/patch.ts                 |  100.00 |   96.92 | 20
 src/features/code/refactor.ts              |  100.00 |  100.00 | 
 src/features/code/write.ts                 |  100.00 |  100.00 | 
 src/features/context/execute.ts            |  100.00 |  100.00 | 
 src/features/doctor/execute.ts             |  100.00 |   96.15 | 26
 src/features/embed/cli.ts                  |  100.00 |  100.00 | 
 src/features/embed/engine.ts               |  100.00 |   97.62 | 
 src/features/eval/scorers/deterministic.ts |   85.71 |  100.00 | 
 src/features/fix/execute.ts                |  100.00 |  100.00 | 
 src/features/goal/execute.ts               |  100.00 |  100.00 | 
 src/features/guardrail/builtin.ts          |  100.00 |  100.00 | 
 src/features/guardrail/cli.ts              |   95.83 |   84.23 | 147-149,161-162,184,188-189,267-268,285-286,293-295,305-306,321-322,362-363,370-372,393,395-398,404-406,428-429,436-438,441-443,450-451,522-532,538-540
 src/features/guardrail/contracts.ts        |  100.00 |  100.00 | 
 src/features/guardrail/engine.ts           |   87.50 |  100.00 | 
 src/features/guardrail/profiles.ts         |  100.00 |   86.21 | 33,56,103-105,110-112
 src/features/guardrail/schemas.ts          |  100.00 |  100.00 | 
 src/features/guardrail/spec.ts             |  100.00 |   98.23 | 97-98
 src/features/identity/init.ts              |  100.00 |  100.00 | 
 src/features/identity/templates.ts         |  100.00 |  100.00 | 
 src/features/index/execute.ts              |  100.00 |  100.00 | 
 src/features/init/execute.ts               |  100.00 |  100.00 | 
 src/features/mcp/alias.ts                  |  100.00 |   83.56 | 21,31-32,46-47,50-51,66,79-80,85
 src/features/mcp/call.ts                   |  100.00 |   88.61 | 34,46-47,54-55,76-77,99-100
 src/features/mcp/cli.ts                    |   66.67 |   98.85 | 
 src/features/mcp/configure.ts              |  100.00 |   90.43 | 31,43-44,49-50,54-55,63-64
 src/features/mcp/disable.ts                |  100.00 |   94.29 | 38-39
 src/features/mcp/enable.ts                 |  100.00 |   94.29 | 38-39
 src/features/mcp/helpers.ts                |  100.00 |   92.86 | 8,49,78,88-89
 src/features/mcp/info.ts                   |  100.00 |   65.22 | 17,25-26,31-32,40-41,46-54
 src/features/mcp/init.ts                   |   90.00 |   99.36 | 
 src/features/mcp/install.ts                |  100.00 |   93.33 | 62-65
 src/features/mcp/list.ts                   |  100.00 |   39.13 | 26,28-35,38-53,57-59
 src/features/mcp/marketplace.ts            |  100.00 |   83.67 | 19-20,50,57,79,87-88,98,116-117,126-131
 src/features/mcp/resource.ts               |  100.00 |   80.00 | 18,26-27,33-34,43-44,55,60-61
 src/features/mcp/test-utils.ts             |  100.00 |  100.00 | 
 src/features/mcp/test.ts                   |  100.00 |   79.59 | 18,25-26,31-32,41-42,53,58-59
 src/features/mcp/uninstall.ts              |  100.00 |   79.49 | 17,24-25,30-31,39-40
 src/features/memory/engine.ts              |  100.00 |  100.00 | 
 src/features/memory/reflect.ts             |  100.00 |  100.00 | 
 src/features/memory/summarize.ts           |  100.00 |   98.36 | 
 src/features/pr/gh.ts                      |  100.00 |  100.00 | 
 src/features/prompt/engine.ts              |  100.00 |  100.00 | 
 src/features/prompt/injection.ts           |  100.00 |  100.00 | 
 src/features/prompt/service.ts             |  100.00 |   98.92 | 
 src/features/read/cli.ts                   |  100.00 |  100.00 | 
 src/features/review/discovery.ts           |  100.00 |   97.37 | 
 src/features/review/execute.ts             |  100.00 |   88.39 | 62-63,67-69,71-72,77-80,84,98,177-180
 src/features/run/parser.ts                 |  100.00 |  100.00 | 
 src/features/search/engine.ts              |  100.00 |   95.95 | 52-54,114,150,178,229,237
 src/features/skills/cli.ts                 |  100.00 |  100.00 | 
 src/features/skills/manager.ts             |   94.74 |  100.00 | 
 src/features/skills/templates.ts           |  100.00 |  100.00 | 
 src/test-utils/cli-env.ts                  |  100.00 |  100.00 | 
 tmp_features/bar/cli.ts                    |    0.00 |  100.00 | 
 tmp_features/baz/cli.ts                    |  100.00 |  100.00 | 
 tmp_features/foo/cli.ts                    |    0.00 |  100.00 | 
--------------------------------------------|---------|---------|-------------------

 496 pass
 11 fail
 1044 expect() calls
Ran 507 tests across 102 files. [36.71s]
